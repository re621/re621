{"version":3,"file":"script.user.js","mappings":"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","sources":["webpack://re621/./src/js/components/api/XMConnect.ts","webpack://re621/./src/js/components/api/XM.ts","webpack://re621/./src/js/components/api/XMStorage.ts","webpack://re621/./src/js/components/api/XMUtil.ts","webpack://re621/./src/js/components/utility/Debug.ts","webpack://re621/./src/js/components/utility/UtilID.ts","webpack://re621/./src/js/components/utility/UtilNetwork.ts","webpack://re621/./src/js/components/utility/UtilSize.ts","webpack://re621/./src/js/components/utility/UtilTime.ts","webpack://re621/./src/js/components/utility/Util.ts","webpack://re621/./src/js/components/utility/UtilDOM.ts","webpack://re621/./src/js/components/utility/UtilEvents.ts","webpack://re621/./src/js/components/utility/UtilMath.ts","webpack://re621/./src/js/components/api/E621.ts","webpack://re621/./src/js/components/data/User.ts","webpack://re621/./src/js/components/data/Page.ts","webpack://re621/./src/js/components/structure/DOMTools.ts","webpack://re621/./src/js/components/structure/PageObserver.ts","webpack://re621/./src/js/models/Script.ts","webpack://re621/./src/js/components/structure/Modal.ts","webpack://re621/./src/js/components/utility/ErrorHandler.ts","webpack://re621/./src/js/components/data/Keybinds.ts","webpack://re621/./src/js/components/structure/Form.ts","webpack://re621/./src/js/modules/Component.ts","webpack://re621/./src/js/modules/general/HeaderCustomizer.ts","webpack://re621/./src/js/modules/general/ThemeCustomizer.ts","webpack://re621/./src/js/modules/minor/DMailHeaderButton.ts","webpack://re621/./src/RE621.ts"],"sourcesContent":["import Debug from \"../utility/Debug\";\nimport XM from \"./XM\";\nexport default class XMConnect {\n    /**\n     * Make a cross-domain xmlHttpRequest.\n     * For userscripts, the domain name MUST be defined in @resource tag.\n     * For extensions, the domain name MUST be listed in the permissions.\n     * @param details Request details\n     */\n    static xmlHttpRequest(details) {\n        Debug.connectLog(details.url);\n        GM_xmlhttpRequest(XMConnect.validateXHRDetails(details));\n    }\n    /**\n     * Cross-domain xmlHttpRequest, wrapped in a Promise.\n     * For userscripts, the domain name MUST be defined in @resource tag.\n     * For extensions, the domain name MUST be listed in the permissions.\n     * @param details Request details\n     */\n    static xmlHttpPromise(details) {\n        const validDetails = XMConnect.validateXHRDetails(details);\n        return new Promise((resolve, reject) => {\n            const callbacks = {\n                onabort: validDetails.onabort,\n                onerror: validDetails.onerror,\n                onload: validDetails.onload,\n                onloadstart: validDetails.onloadstart,\n                onprogress: validDetails.onprogress,\n                onreadystatechange: validDetails.onreadystatechange,\n                ontimeout: validDetails.ontimeout,\n            };\n            details.onabort = (event) => { callbacks.onabort(event); reject(event); };\n            details.onerror = (event) => { callbacks.onerror(event); reject(event); };\n            details.onload = (event) => { callbacks.onload(event); resolve(event); };\n            details.onloadstart = (event) => { callbacks.onloadstart(event); };\n            details.onprogress = (event) => { callbacks.onprogress(event); };\n            details.onreadystatechange = (event) => { callbacks.onreadystatechange(event); };\n            details.ontimeout = (event) => { callbacks.ontimeout(event); reject(event); };\n            XMConnect.xmlHttpRequest(validDetails);\n        });\n    }\n    /**\n     * Validates the xmlHttpRequest details, returning a valid set\n     * @param details Request details\n     */\n    static validateXHRDetails(details) {\n        if (details.headers === undefined)\n            details.headers = {};\n        if (details.headers[\"User-Agent\"] === undefined) {\n            details.headers[\"User-Agent\"] = window[\"re621\"][\"useragent\"];\n            details.headers[\"X-User-Agent\"] = window[\"re621\"][\"useragent\"];\n        }\n        if (details.onabort === undefined)\n            details.onabort = () => { return; };\n        if (details.onerror === undefined)\n            details.onerror = () => { return; };\n        if (details.onload === undefined)\n            details.onload = () => { return; };\n        if (details.onloadstart === undefined)\n            details.onloadstart = () => { return; };\n        if (details.onprogress === undefined)\n            details.onprogress = () => { return; };\n        if (details.onreadystatechange === undefined)\n            details.onreadystatechange = () => { return; };\n        if (details.ontimeout === undefined)\n            details.ontimeout = () => { return; };\n        return details;\n    }\n    static download(a, b) {\n        if (typeof a === \"string\") {\n            a = {\n                url: a,\n                name: b,\n            };\n        }\n        if (a.headers === undefined)\n            a.headers = {\n                \"User-Agent\": window[\"re621\"][\"useragent\"],\n                \"X-User-Agent\": window[\"re621\"][\"useragent\"],\n            };\n        if (a.onerror === undefined)\n            a.onerror = () => { return; };\n        if (a.onload === undefined)\n            a.onload = () => { return; };\n        if (a.onprogress === undefined)\n            a.onprogress = () => { return; };\n        if (a.ontimeout === undefined)\n            a.ontimeout = () => { return; };\n        let timer;\n        XMConnect.xmlHttpRequest({\n            url: a.url,\n            method: \"GET\",\n            headers: a.headers,\n            responseType: \"blob\",\n            onerror: (event) => { a.onerror(event); },\n            ontimeout: (event) => { a.ontimeout(event); },\n            onprogress: (event) => {\n                if (timer)\n                    clearTimeout(timer);\n                timer = window.setTimeout(() => { a.onprogress(event); }, 500);\n            },\n            onload: (event) => {\n                a.onload(event);\n                const btn = $(\"<a>\")\n                    .attr({\n                    href: URL.createObjectURL(event.response),\n                    download: a.name,\n                })\n                    .html(\"download\")\n                    .on(\"click\", () => { btn.remove(); });\n                btn[0].click();\n            }\n        });\n    }\n    static browserDownload(a, b, c) {\n        // Fallback to avoid a crash in Vivaldi\n        if (Debug.getState(\"vivaldi\"))\n            XM.Connect.download(a, b);\n        const downloadDetails = typeof a === \"string\"\n            ? { url: a, name: b, saveAs: c }\n            : a;\n        // Workaround to SWF files not being whitelisted by default in Tampermonkey\n        downloadDetails.onerror = (event) => {\n            if (event.error == \"not_whitelisted\")\n                XM.Connect.download(a, b);\n            else if (a.onerror)\n                a.onerror(event);\n            else\n                throw \"Error: unable to download file\" + (event.error ? (` [${event.error}]`) : \"\");\n        };\n        // All script managers should have a GM_download function\n        GM_download(a);\n    }\n}\n","import XMConnect from \"./XMConnect\";\nimport XMStorage from \"./XMStorage\";\nimport XMUtil from \"./XMUtil\";\nexport default class XM {\n}\nXM.Storage = XMStorage;\nXM.Connect = XMConnect;\nXM.Util = XMUtil;\nXM.Window = typeof unsafeWindow === \"undefined\" ? window : unsafeWindow;\n/** Returns the information provided by the script manager */\nXM.Info = GM_info;\n","export default class XMStorage {\n    static setValue(name, value) {\n        GM_setValue(name, value);\n    }\n    static getValue(name, defaultValue) {\n        return GM_getValue(name, defaultValue);\n    }\n    static deleteValue(name) {\n        GM_deleteValue(name);\n    }\n    static addListener(name, callback) {\n        return GM_addValueChangeListener(name, callback);\n    }\n    static removeListener(id) {\n        GM_removeValueChangeListener(id);\n    }\n}\n","export default class XMUtil {\n    /**\n     * Open a new tab with this url.\n     * @param url Page URL\n     * @param options Tab options\n     */\n    static openInTab(path, active = true) {\n        return GM_openInTab(path, { active: active, });\n    }\n    /**\n     * Copies data into the clipboard\n     * @param data Data to be copied\n     * @param info object like \"{ type: 'text', mimetype: 'text/plain'}\" or a string expressing the type (\"text\" or \"html\")\n     */\n    static setClipboard(data, info) {\n        GM_setClipboard(data, info);\n    }\n}\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport XM from \"../api/XM\";\nexport default class Debug {\n    /** Initialize the debug logger */\n    static init() {\n        return __awaiter(this, void 0, void 0, function* () {\n            Debug.enabled = yield XM.Storage.getValue(\"re621.debug.enabled\", false);\n            Debug.connect = yield XM.Storage.getValue(\"re621.debug.connect\", false);\n            Debug.perform = yield XM.Storage.getValue(\"re621.debug.perform\", false);\n            Debug.vivaldi = yield XM.Storage.getValue(\"re621.debug.vivaldi\", false);\n            return Promise.resolve(true);\n        });\n    }\n    static getState(type) {\n        return Debug[type];\n    }\n    static setState(type, enabled) {\n        Debug[type] = enabled;\n        if (enabled)\n            XM.Storage.setValue(\"re621.debug.\" + type, enabled);\n        else\n            XM.Storage.deleteValue(\"re621.debug.\" + type);\n    }\n    /** Logs the provided data into the console log if debug is enabled */\n    static log(...data) {\n        if (Debug.enabled)\n            console.log(...data);\n    }\n    /** Logs the provided data as a table */\n    static table(obj) {\n        if (!Debug.enabled)\n            return;\n        console.table(obj);\n    }\n    /** Logs the provided data into the console log if connections logging is enabled */\n    static connectLog(...data) {\n        if (Debug.connect)\n            console.log(\"CONNECT\", ...data);\n    }\n    /** Logs the provided data into the console log if performance logging is enabled */\n    static perfStart(input) {\n        if (Debug.perform)\n            console.time(input);\n    }\n    /** Logs the provided data into the console log if performance logging is enabled */\n    static perfEnd(input) {\n        if (Debug.perform)\n            console.timeEnd(input);\n    }\n}\n","import Util from \"./Util\";\nexport default class UtilID {\n    /**\n     * Creates a random string of letters, to be used as an ID.\n     * @param length String length. Defaults to 8\n     * @param unique If false, simply returns a randomized string\n     */\n    static make(length = 8, unique = true) {\n        if (!unique)\n            return getRandomString(length);\n        let uniqueID;\n        do {\n            uniqueID = getRandomString(length);\n        } while (UtilID.uniqueIDs.has(uniqueID));\n        UtilID.uniqueIDs.add(uniqueID);\n        return uniqueID;\n        function getRandomString(length) {\n            let result = '';\n            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789', charLength = chars.length;\n            for (let i = 0; i < length; i++) {\n                result += chars.charAt(Math.floor(Math.random() * charLength));\n            }\n            return result;\n        }\n    }\n    /**\n     * Checks whether the specified ID has been registered\n     * @param id String ID to check\n     */\n    static has(id) {\n        return UtilID.uniqueIDs.has(id);\n    }\n    /**\n     * Remove the provided ID from the records.\n     * Make sure that the corresponding element has also been removed, to avoid possible collisions\n     * @param id String ID to remove\n     * @returns true if the ID existed, false otherwise\n     */\n    static remove(id) {\n        if (!UtilID.has(id))\n            return false;\n        UtilID.uniqueIDs.delete(id);\n        return true;\n    }\n    /** Returns a pseudo-random number. Don't use for anything serious, please. */\n    static rand() {\n        return (Util.Time.now() + \"\").slice(-5);\n    }\n}\nUtilID.uniqueIDs = new Set();\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport XM from \"../api/XM\";\nexport class UtilNetwork {\n    static isOnline() {\n        return __awaiter(this, void 0, void 0, function* () {\n            // Not terribly reliable.\n            // If the computer is connected to any network, including LAN, this\n            // will return true. So, if there's a connection to the router, but\n            // not to the internet as a whole, this will not work.\n            if (!navigator.onLine)\n                return Promise.resolve(false);\n            // Fallback method\n            // Tries to make a HEAD request to e621.net, and checks if it works\n            return new Promise((resolve) => {\n                XM.Connect.xmlHttpRequest({\n                    method: \"HEAD\",\n                    url: window.location.host == \"e621.net\" ? \"https://e621.net/\" : \"https://e926.net/\",\n                    onerror: () => { resolve(false); },\n                    onload: () => { resolve(true); },\n                });\n            });\n        });\n    }\n}\n","import Util from \"./Util\";\nexport var UtilSize;\n(function (UtilSize) {\n    UtilSize[UtilSize[\"Byte\"] = 1] = \"Byte\";\n    UtilSize[UtilSize[\"Kilobyte\"] = 1024] = \"Kilobyte\";\n    UtilSize[UtilSize[\"Megabyte\"] = 1048576] = \"Megabyte\";\n    UtilSize[UtilSize[\"Gigabyte\"] = 1073741824] = \"Gigabyte\";\n    UtilSize[UtilSize[\"Terabyte\"] = 1099511627776] = \"Terabyte\";\n    UtilSize[UtilSize[\"Petabyte\"] = 1125899906842624] = \"Petabyte\";\n})(UtilSize || (UtilSize = {}));\n(function (UtilSize) {\n    /**\n     * Converts a byte number into a formatted string\n     * @param bytes Number\n     * @param decimals Decimal places\n     */\n    function format(bytes, decimals = 2) {\n        if (typeof bytes == \"string\")\n            bytes = parseInt(bytes);\n        if (!bytes || bytes === 0)\n            return \"0 B\";\n        const k = 1024;\n        const dm = decimals < 0 ? 0 : decimals;\n        const sizes = [\"B\", \"KB\", \"MB\", \"GB\", \"TB\", \"PB\"];\n        const i = Math.floor(Math.log(bytes) / Math.log(k));\n        return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + sizes[i];\n    }\n    UtilSize.format = format;\n    /**\n     * Takes in a formatted file size string (ex. 5MB) and converts it to bytes\n     * @param input Formatted string\n     */\n    function unformat(input) {\n        if (Util.Math.isNumeric(input))\n            return parseInt(input);\n        input = input.toUpperCase();\n        for (const [index, size] of [/\\dB$/, /\\dKB$/, /\\dMB$/, /\\dGB$/, /\\dTB$/, /\\dPB$/].entries()) {\n            if (size.test(input)) {\n                return parseInt(input) * Math.pow(1024, index);\n            }\n        }\n        return 0;\n    }\n    UtilSize.unformat = unformat;\n})(UtilSize || (UtilSize = {}));\nexport class RISSizeLimit {\n    constructor(size, width = 0, height = 0) {\n        this.size = size;\n        this.width = width;\n        this.height = height;\n    }\n    test(post) {\n        return post.file.size <= this.size\n            && (this.width == 0 || post.img.width <= this.width)\n            && (this.height == 0 || post.img.height <= this.height);\n    }\n    toString() {\n        return `${this.width}x${this.height} (${this.size})`;\n    }\n}\nRISSizeLimit.Google = new RISSizeLimit(20 * UtilSize.Megabyte, 8000, 6000);\nRISSizeLimit.SauceNAO = new RISSizeLimit(15 * UtilSize.Megabyte);\nRISSizeLimit.Derpibooru = new RISSizeLimit(20 * UtilSize.Megabyte);\nRISSizeLimit.Kheina = new RISSizeLimit(8 * UtilSize.Megabyte, 7500, 7500);\nRISSizeLimit.Yandex = new RISSizeLimit(100 * UtilSize.Megabyte, 150000, 150000);\n","export var UtilTime;\n(function (UtilTime) {\n    UtilTime[UtilTime[\"SECOND\"] = 1000] = \"SECOND\";\n    UtilTime[UtilTime[\"MINUTE\"] = 60000] = \"MINUTE\";\n    UtilTime[UtilTime[\"HOUR\"] = 3600000] = \"HOUR\";\n    UtilTime[UtilTime[\"DAY\"] = 86400000] = \"DAY\";\n    UtilTime[UtilTime[\"WEEK\"] = 604800000] = \"WEEK\";\n    UtilTime[UtilTime[\"MONTH\"] = 2592000000] = \"MONTH\";\n    UtilTime[UtilTime[\"YEAR\"] = 31536000000] = \"YEAR\";\n})(UtilTime || (UtilTime = {}));\n(function (UtilTime) {\n    /** Returns current timestamp. Alias for `new Date().getTime();` */\n    function now() {\n        return new Date().getTime();\n    }\n    UtilTime.now = now;\n    /**\n     * Converts time from absolute format to relative (i.e. \"5 minutes ago\")\n     * @param time Time to process\n     * @returns Relative time string\n     */\n    function ago(time) {\n        switch (typeof time) {\n            case 'string':\n                time = +new Date(time);\n                break;\n            case 'object':\n                time = time.getTime();\n                break;\n        }\n        const timeFormats = [\n            [60, 'seconds', 1],\n            [120, '1 minute ago', '1 minute from now'],\n            [3600, 'minutes', 60],\n            [7200, '1 hour ago', '1 hour from now'],\n            [86400, 'hours', 3600],\n            [172800, 'Yesterday', 'Tomorrow'],\n            [604800, 'days', 86400],\n            [1209600, 'Last week', 'Next week'],\n            [2419200, 'weeks', 604800],\n            [4838400, 'Last month', 'Next month'],\n            [29030400, 'months', 2419200],\n            [58060800, 'Last year', 'Next year'],\n            [2903040000, 'years', 29030400],\n            [5806080000, 'Last century', 'Next century'],\n            [58060800000, 'centuries', 2903040000] // 60*60*24*7*4*12*100*20, 60*60*24*7*4*12*100\n        ];\n        let seconds = (+new Date() - time) / 1000, token = 'ago', listChoice = 1;\n        if (seconds >= 0 && seconds < 2) {\n            return 'Just now';\n        }\n        if (seconds < 0) {\n            seconds = Math.abs(seconds);\n            token = 'from now';\n            listChoice = 2;\n        }\n        let i = 0, format;\n        // eslint-disable-next-line no-cond-assign\n        while (format = timeFormats[i++])\n            if (seconds < format[0]) {\n                if (typeof format[2] == 'string')\n                    return format[listChoice];\n                else\n                    return Math.floor(seconds / format[2]) + ' ' + format[1] + ' ' + token;\n            }\n        return time + \"\";\n    }\n    UtilTime.ago = ago;\n    /**\n     * Formats the provided date as a string in YYYY-MM-DD HH:SS format\n     * @param date Date to format. If none is provided, formats current date\n     */\n    function format(date = new Date()) {\n        if (typeof date == \"number\" || typeof date == \"string\")\n            date = new Date(date);\n        const parts = {\n            year: \"\" + date.getFullYear(),\n            month: \"\" + (date.getMonth() + 1),\n            day: \"\" + date.getDate(),\n            hours: \"\" + date.getHours(),\n            minutes: \"\" + date.getMinutes(),\n            seconds: \"\" + date.getSeconds(),\n        };\n        for (const id in parts) {\n            if (parts[id].length < 2)\n                parts[id] = \"0\" + parts[id];\n        }\n        return parts.year + \"-\" + parts.month + \"-\" + parts.day + \" \" + parts.hours + \":\" + parts.minutes + \":\" + parts.seconds;\n    }\n    UtilTime.format = format;\n    function formatPeriod(input) {\n        if (input < UtilTime.MINUTE)\n            return (input / UtilTime.SECOND).toFixed(1) + \" seconds\";\n        if (input < UtilTime.HOUR)\n            return (input / UtilTime.MINUTE).toFixed(1) + \" minutes\";\n        if (input < UtilTime.DAY)\n            return (input / UtilTime.HOUR).toFixed(1) + \" hours\";\n        if (input < UtilTime.WEEK)\n            return (input / UtilTime.DAY).toFixed(1) + \" days\";\n        if (input < UtilTime.MONTH)\n            return (input / UtilTime.WEEK).toFixed(1) + \" weeks\";\n        if (input < UtilTime.YEAR)\n            return (input / UtilTime.MONTH).toFixed(1) + \" months\";\n        return (input / UtilTime.YEAR).toFixed(1) + \" years\";\n    }\n    UtilTime.formatPeriod = formatPeriod;\n    /**\n     * Returns the current date and time in a compressed format.\n     * Used to make downloaded file names unique, i.e. download-200405-0350.zip instead of download.zip\n     * @returns String with a date and time in YYMMDD-HHMM format.\n     */\n    function getDatetimeShort() {\n        function twoDigit(n) { return (n < 10 ? '0' : '') + n; }\n        const date = new Date();\n        return (date.getFullYear() + \"\").substring(2) + twoDigit(date.getMonth() + 1) + twoDigit(date.getDate()) + \"-\" + twoDigit(date.getHours()) + twoDigit(date.getMinutes());\n    }\n    UtilTime.getDatetimeShort = getDatetimeShort;\n    function formatPlaytime(seconds) {\n        seconds = Math.ceil(seconds);\n        const remainder = (seconds % 60);\n        return Math.floor(seconds / 60) + \":\" + (remainder < 10 ? \"0\" : \"\") + remainder;\n    }\n    UtilTime.formatPlaytime = formatPlaytime;\n})(UtilTime || (UtilTime = {}));\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { UtilDOM } from \"./UtilDOM\";\nimport { UtilEvents } from \"./UtilEvents\";\nimport UtilID from \"./UtilID\";\nimport { UtilMath } from \"./UtilMath\";\nimport { UtilNetwork } from \"./UtilNetwork\";\nimport { UtilSize } from \"./UtilSize\";\nimport { UtilTime } from \"./UtilTime\";\n/**\n * Common utilities used in other modules\n */\nexport default class Util {\n    /**\n     * Downloads the provided object as a JSON file\n     * @param data Object to download\n     * @param file File name\n     */\n    static downloadAsJSON(data, file) {\n        const tempLink = $(\"<a>\")\n            .attr({\n            \"download\": file + \".json\",\n            \"href\": \"data:application/json,\" + encodeURIComponent(JSON.stringify(data, null, 4)),\n        })\n            .appendTo(\"body\")\n            .on(\"click\", () => { tempLink.remove(); });\n        tempLink[0].click();\n    }\n    /**\n     * Returns a promise that is fulfilled after the specified time period elapses\n     * @param time Time period, in milliseconds\n     */\n    static sleep(time) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return new Promise((resolve) => { setTimeout(() => { resolve(); }, time); });\n        });\n    }\n    /**\n     * Split the array into chunks of specified size.\n     * The `method` parameter defines how the array is split.\n     * - \"balance\": the chunks are at most `size` big, but otherwise of equal size\n     * - \"chunk\": all chunks except for the last one of equal size\n     * - \"split\": first chunk is `size` big, the second contains the remainder\n     * @param input Original array\n     * @param size Size of the resulting chunks\n     * @param method Method by which the array is split\n     * @returns Array of smaller arrays of specified size\n     */\n    static chunkArray(input, size, method = \"balance\") {\n        if (!Array.isArray(input))\n            input = Array.from(input);\n        const result = [];\n        switch (method) {\n            case \"chunk\": {\n                for (let i = 0; i < input.length; i += size)\n                    result.push(input.slice(i, i + size));\n                break;\n            }\n            case \"split\": {\n                result[0] = input.slice(0, size);\n                result[1] = input.slice(size);\n                break;\n            }\n            case \"balance\":\n            default: {\n                const parts = Math.ceil(input.length / size);\n                for (let i = parts; i > 0; i--)\n                    result.push(input.splice(0, Math.ceil(input.length / i)));\n            }\n        }\n        return result;\n    }\n    /**\n     * Returns the indexes of all instances of the specified value in an array\n     * @param input Array to search\n     * @param value Value to look for\n     * @returns Array of number indexes\n     */\n    static getArrayIndexes(input, value) {\n        const indexes = [];\n        let i = 0;\n        for (; i < input.length; i++) {\n            if (input[i] === value)\n                indexes.push(i);\n        }\n        return indexes;\n    }\n    /**\n     * Convert markdown input into html.\n     * Very limited in scope, don't rely on this for anything important.\n     * @param input Markdown input\n     * @returns HTML output\n     */\n    static quickParseMarkdown(input) {\n        if (input === undefined)\n            return \"\";\n        return input\n            .replace(/\\*\\*(.*?)\\*\\*/gm, \"<strong>$1</strong>\")\n            .replace(/_(.*?\\S)_/gm, \"<em>$1</em>\")\n            .replace(/\\[(.+)\\]\\((.*)\\)/gm, `<a href=\"$2\">$1</a>`)\n            .replace(/^[-]+(.*)?/gmi, \"<ul><li>$1</li></ul>\")\n            .replace(/<\\/ul>\\r\\n<ul>/gm, \"\")\n            .replace(/\\n(?!<)/gm, \"<br />\");\n    }\n    /**\n     * Parses the provided DText string, returning it as plain text\n     * @param input Input to process\n     * @param removeSections If true, removes `quote`, `code`, and `sections` blocks altogether\n     */\n    static stripDText(input, removeSections = true) {\n        if (removeSections) {\n            input = input.replace(/\\[quote\\][\\s\\S]*\\[\\/quote\\]/g, \"\")\n                .replace(/\\[code\\][\\s\\S]*\\[\\/code\\]/g, \"\")\n                .replace(/\\\\[section[\\s\\S]*\\[\\/section\\]/g, \"\");\n        }\n        input = input\n            .replace(/\\[b\\]([\\s\\S]*)\\[\\/b\\]/g, \"<b>$1</b>\") // bold\n            .replace(/\\[i\\]([\\s\\S]*)\\[\\/i\\]/g, \"<i>$1</i>\") // italics\n            .replace(/\\[u\\]([\\s\\S]*)\\[\\/u\\]/g, \"<u>$1</u>\") // Underline\n            .replace(/\\[o\\]([\\s\\S]*)\\[\\/o\\]/g, \"<o>$1</o>\") // Overline\n            .replace(/\\[s\\]([\\s\\S]*)\\[\\/s\\]/g, \"<s>$1</s>\") // Strikeout\n            .replace(/\\[sup\\]([\\s\\S]*)\\[\\/sup\\]/g, \"<sup>$1</sup>\") // Superscript\n            .replace(/\\[sub\\]([\\s\\S]*)\\[\\/sub\\]/g, \"<sub>$1</sub>\") // Subscript\n            .replace(/\\[spoiler\\]([\\s\\S]*)\\[\\/spoiler\\]/g, \"<span>$1</span>\") // Spoiler\n            .replace(/\\[color\\]([\\s\\S]*)\\[\\/color\\]/g, \"<span>$1</span>\"); // Color\n        return input;\n    }\n    /**\n     * Trims the thousands off a number and replaced them with a K.\n     * ex. 54321 -> 54.3k\n     * @param num Number to trim\n     */\n    static formatK(num) {\n        return Math.abs(num) > 999 ? (Math.sign(num) * (Math.abs(num) / 1000)).toFixed(1) + \"k\" : Math.sign(num) * Math.abs(num) + \"\";\n    }\n    /* returns an array with the ratio */\n    static formatRatio(width, height) {\n        const d = gcd(width, height);\n        return [width / d, height / d];\n        function gcd(u, v) {\n            if (u === v)\n                return u;\n            if (u === 0)\n                return v;\n            if (v === 0)\n                return u;\n            if (~u & 1)\n                if (v & 1)\n                    return gcd(u >> 1, v);\n                else\n                    return gcd(u >> 1, v >> 1) << 1;\n            if (~v & 1)\n                return gcd(u, v >> 1);\n            if (u > v)\n                return gcd((u - v) >> 1, v);\n            return gcd((v - u) >> 1, u);\n        }\n    }\n    /**\n     * Parses the textarea input specified in the parameter and returns a list of space-separated tags\n     * @param input Textarea to parse\n     */\n    static getTagString(input) {\n        return input.val().toString().trim()\n            .toLowerCase()\n            .replace(/\\r?\\n|\\r/g, \" \") // strip newlines\n            .replace(/(?:\\s){2,}/g, \" \"); // strip multiple spaces\n    }\n    static getTags(input) {\n        if (Array.isArray(input)) {\n            const result = [];\n            for (const element of input)\n                result.push(...Util.getTags(element));\n            return result;\n        }\n        return (typeof input === \"string\" ? input : Util.getTagString(input))\n            .split(\" \")\n            .filter((el) => { return el != null && el != \"\"; });\n    }\n    /** Takes in an object, and returns a regular expression with its keys */\n    static getKeyRegex(object) {\n        const result = [];\n        for (const key of Object.keys(object))\n            result.push(key.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'));\n        return new RegExp(result.join(\"|\"), \"gi\");\n    }\n    /**\n     * Compares two software version numbers (e.g. \"1.7.1\" or \"1.2b\").\n     *\n     * This function was born in http://stackoverflow.com/a/6832721.\n     *\n     * @param v1 The first version to be compared.\n     * @param v2 The second version to be compared.\n     * @param [options] Optional flags that affect comparison behavior:\n     *      `lexicographical` _boolean_ compares each part of the version strings lexicographically instead of\n     *      naturally; this allows suffixes such as \"b\" or \"dev\" but will cause \"1.10\" to be considered smaller than \"1.2\".\n     *      `zeroExtend` _boolean_ changes the result if one version string has less parts than the other. In\n     *         this case the shorter string will be padded with \"zero\" parts instead of being considered smaller.\n     * @returns {number|NaN}\n     *      - 0 if the versions are equal\n     *      - a negative integer iff v1 < v2\n     *      - a positive integer iff v1 > v2\n     *      - NaN if either version string is in the wrong format\n     * @copyright by Jon Papaioannou (`john.papaioannou@gmail.com`)\n     * @license This function is in the public domain. Do what you want with it, no strings attached.\n     */\n    static versionCompare(v1, v2, options) {\n        const lexicographical = options && options.lexicographical, zeroExtend = options && options.zeroExtend;\n        if (typeof v1 !== \"string\" || typeof v2 !== \"string\")\n            return NaN;\n        let v1parts = v1.split('.'), v2parts = v2.split('.');\n        function isValidPart(x) {\n            return (lexicographical ? /^\\d+[A-Za-z]*$/ : /^\\d+$/).test(x);\n        }\n        if (!v1parts.every(isValidPart) || !v2parts.every(isValidPart))\n            return NaN;\n        if (zeroExtend) {\n            while (v1parts.length < v2parts.length)\n                v1parts.push(\"0\");\n            while (v2parts.length < v1parts.length)\n                v2parts.push(\"0\");\n        }\n        if (!lexicographical) {\n            v1parts = v1parts.map(Number);\n            v2parts = v2parts.map(Number);\n        }\n        for (let i = 0; i < v1parts.length; ++i) {\n            if (v2parts.length == i)\n                return 1;\n            if (v1parts[i] == v2parts[i])\n                continue;\n            else if (v1parts[i] > v2parts[i])\n                return 1;\n            else\n                return -1;\n        }\n        if (v1parts.length != v2parts.length)\n            return -1;\n        return 0;\n    }\n    /**\n     * Formats an array into a string via a non-standard join method.\n     * Ex. [\"one\"] => \"one\"\n     *     [\"one\", \"two\"] => \"one and two\"\n     *     [\"one\", \"two\", \"three\"] => \"one, two, and three\"\n     * @param array Array to format\n     * @param delimiter Delimiter for the last element\n     */\n    static prettyPrintArray(array, delimiter = \"and\") {\n        if (array.length == 1)\n            return array[0];\n        else if (array.length == 2)\n            return array[0] + \" \" + delimiter + \" \" + array[1];\n        return array.slice(0, -1).join(\", \") + \", \" + delimiter + \" \" + array.slice(-1);\n    }\n}\nUtil.DOM = UtilDOM;\nUtil.Events = UtilEvents;\nUtil.ID = UtilID;\nUtil.Math = UtilMath;\nUtil.Network = UtilNetwork;\nUtil.Time = UtilTime;\nUtil.Size = UtilSize;\nUtil.LS = window.localStorage;\nUtil.SS = window.sessionStorage;\n","import Util from \"./Util\";\nexport class UtilDOM {\n    /**\n     * Adds a button to the top-right of the navbar\n     * @param config Button configuration\n     * @param target Target element\n     */\n    static addSettingsButton(config, target = \"menu.extra\") {\n        if (config.name === undefined)\n            config.name = \"T\";\n        if (config.href === undefined)\n            config.href = \"\";\n        if (config.title === undefined)\n            config.title = \"\";\n        if (config.tabClass === undefined)\n            config.tabClass = \"\";\n        if (config.linkClass === undefined)\n            config.linkClass = \"\";\n        if (config.attr === undefined)\n            config.attr = {};\n        const $tab = $(`<li>`).appendTo(target);\n        const $link = $(\"<a>\")\n            .html(config.name)\n            .attr({\n            \"title\": config.title,\n            \"id\": config.id,\n        })\n            .appendTo($tab);\n        if (config.onClick !== undefined)\n            $link.on(\"click\", () => { config.onClick($link); });\n        if (config.href) {\n            $link.attr(\"href\", config.href);\n        }\n        if (config.tabClass) {\n            $tab.addClass(config.tabClass);\n        }\n        if (config.linkClass) {\n            $link.addClass(config.linkClass);\n        }\n        if (config.attr) {\n            $link.attr(config.attr);\n        }\n        return $link;\n    }\n    /**\n     * Adds the given style to the document and returns the injected style element\n     * @param css string CSS styles\n     */\n    static addStyle(css) {\n        return $(\"<style>\")\n            .attr({\n            \"id\": Util.ID.make(),\n            \"type\": \"text/css\"\n        })\n            .html(css)\n            .appendTo(\"head\");\n    }\n    /**\n     * Returns a base-64 encoded image used for placeholder during lazy loading\n     */\n    static getPlaceholderImage() {\n        return \"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\";\n    }\n    static getKoFiImage() {\n        return \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALsAAAAkBAMAAAAjjlbPAAAAHlBMVEVDS1dDS1dDS1f+/v5DS1fi4uOLjpO8vcD/X1z/p6boDZakAAAAA3RSTlMCtVgF8JOLAAACCElEQVRIx+3XMW7bMBQGYLUnCIoeoENv8OuZ8NbAP8kDUBTRWbRyANLxAbKwc1AguW0H2nJSq6kBV0sRDhpI4BP19PhINs3Hz1yofWqapllMJ2+a5sNyOm+b5uuCPL8sGRvypllS57d3/gLe+KmF+O95jVOTuCiP1eGLxvFySftoffw7Lw5S+xKgLuadj8nnN/j1T3x/BFo61FmksMPFvJDuzeCU8lyKQ8sN6ixSJrin7XRmIBmSsuio0ZE0TnmSFooaPXcIW3hukWnRz/BSSinlES31ke9HoaNuNx2FJATOKcILyUGckHSC6DxyggzACKeYPOI5vz7ngdUrnkNrxK6YMumyFdIIjVUc2hqcTUs3Cod2NjgHfjjyYYf4ghcOHUWLdx0ppJBWkbqlXVV+EI+9eDfHP5VSfgCtcYcfmjJTfsVvKu/zxK9+5/2deN/NZU4p5QGQKR3P+aGj6LoqHE0NDrWiXk3BoVV/yPunUmrqH16ewh4x9anbqO1p9gb3LpIpJCGJPo24d13lrew9XZ/yHL8uDwCAwBfLSgPRQE48E4SkrX1bSBwgx7xPUNxiLnMAPAOAmipBLQpjJMdRSEYaMtae47MORzKShjTjaWS+KLTnK9KGpK4raXbiuxkeyFfW+4mfq8YmXrtb3XnvfQj7/L7X/i/8wofAhY+wCx/AF74+LHv5+QUPP47PCU3CGwAAAABJRU5ErkJggg==\";\n    }\n    static getLoadingImage() {\n        return \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAyVBMVEUAAAC9vsDCw8W9v8G9vsD29/fr7O29vsDm5+jx8fK/wML29vf///+9vsHR0tPm5+jt7u7w8PHr7Ozc3d7n6OnExcfGx8nJyszMzM7V1tjZ2tvf4OG9vsDHyMrp6uvIycu9v8HAwcTPz9HCw8W9vsC9vsDBwsTj5OXj5OXW19i9vsDm5+jw8PHy8vL09fW9vsDFxsjJyszAwsS9vsDU1dbLzM7Y2drb3N3c3d7e3+DHyMrBwsTh4uPR0tPDxcfa293R0tTV1ti9vsAll6RJAAAAQnRSTlMA7+t/MAZHQDYjHxABv6xSQjEgFgzi2M7Emop0cGVLD/ryt7Cfj3dmYWBgWjgsGd/Cv7SvopSSg4B6eHZrQjkyKx1dd0xhAAAA9klEQVR4AYWPeXOCMBBHFxIgCQKC3KCo1Wprtfd98/0/VBPb6TC0Wd+/783+ZqELrQkRoIMujFbiaLTwpESC029reB7919d7u6SgYaE8aUCivW84oEUY0lPQc408pxBqHxCIHGiw4Lxtl5h35ALFglouAAaZTj00OJ7NrvDANI/Q4PlQMDbNFA3ekiQRaHGRpmM0eMqyyxgLRlme4ydu8/n8Az3h+37xiRWv/k1RRlhxUtyVD8yCXwaDflHeP1Zr5sIey3WtfvFeVS+rTWAzFobhNhrFf4omWK03wcS2h8OzLd/1TyhiNvkJQu5amocjznm0i6HDF1RMG1aMA/PYAAAAAElFTkSuQmCC\";\n    }\n}\n","export class UtilEvents {\n    /**\n     * Attaches a handler function to a document event with the specified name\n     * @param name Event selector\n     * @param callback Handler function\n     */\n    static on(name, callback) {\n        $(document).on(name, (event, data) => {\n            callback(event, data);\n        });\n    }\n    /**\n     * Executes a handler function exactly once whe encountering a specified event\n     * @param name Event selector\n     * @param callback Handler function\n     */\n    static one(name, callback) {\n        $(document).on(name, (event, data) => {\n            callback(event, data);\n            this.off(name);\n        });\n    }\n    /**\n     * Detaches all handlers from the specified module event\n     * @param name Event selector\n     */\n    static off(name) {\n        $(document).off(name);\n    }\n    /**\n     * Execute all handlers for the specified module event\n     * @param name Event selector\n     * @param data Event data\n     */\n    static trigger(name, data) {\n        $(document).trigger(name, data);\n    }\n    /**\n     * Workaround for vue not receiving normal events.\n     * @param element Element to trigger the event on\n     * @param name Name of the event to trigger\n     * @param label Data attribute to set on the element\n     */\n    static triggerVueEvent(element, name, label) {\n        const e = document.createEvent('HTMLEvents');\n        e.initEvent(name, true, true);\n        if (label)\n            element.data(label, \"true\");\n        element[0].dispatchEvent(e);\n    }\n}\n","export class UtilMath {\n    static clamp(value, min, max) {\n        return Math.min(Math.max(value, min), max);\n    }\n    static between(value, min, max) {\n        return min <= value && max >= value;\n    }\n    static isNumeric(value) {\n        return !isNaN(Number(value));\n    }\n    static round(num, decimal = 2) {\n        if (decimal == 0)\n            return parseInt(num.toFixed(decimal));\n        else\n            return parseFloat(num.toFixed(decimal));\n    }\n}\n","// E621 API Endpoint Wrapper\n// Version 2.1\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport Debug from \"../utility/Debug\";\nimport Util from \"../utility/Util\";\n// All endpoints must be registered here.\n// Name is irrelevant, as long as it is unique.\n// Path is the endpoint address, without https://e621.net/\n// Don't forget to update the name in the E621 aliases below\nconst ENDPOINT_DEFS = [\n    { name: \"posts\", path: \"posts.json\", node: \"posts\" },\n    { name: \"post\", path: \"posts/%ID%.json\", node: \"post\" },\n    { name: \"post_votes\", path: \"posts/%ID%/votes.json\" },\n    { name: \"tags\", path: \"tags.json\" },\n    { name: \"tag\", path: \"tags/%ID%.json\" },\n    { name: \"tag_aliases\", path: \"tag_aliases.json\" },\n    { name: \"tag_implications\", path: \"tag_implications.json\" },\n    { name: \"notes\", path: \"notes.json\" },\n    { name: \"favorites\", path: \"favorites.json\", node: \"posts\" },\n    { name: \"favorite\", path: \"favorites/%ID%.json\" },\n    { name: \"pools\", path: \"pools.json\" },\n    { name: \"pool\", path: \"pools/%ID%.json\" },\n    { name: \"sets\", path: \"post_sets.json\" },\n    { name: \"set\", path: \"post_sets/%ID%.json\" },\n    { name: \"set_add_post\", path: \"post_sets/%ID%/add_posts.json\" },\n    { name: \"set_remove_post\", path: \"post_sets/%ID%/remove_posts.json\" },\n    { name: \"users\", path: \"users.json\" },\n    { name: \"user\", path: \"users/%ID%.json\" },\n    { name: \"blips\", path: \"blips.json\" },\n    { name: \"wiki_pages\", path: \"wiki_pages.json\" },\n    { name: \"comments\", path: \"comments.json\" },\n    { name: \"comment\", path: \"comments/%ID%.json\" },\n    { name: \"forum_posts\", path: \"forum_posts.json\" },\n    { name: \"forum_post\", path: \"forum_posts/%ID%.json\" },\n    { name: \"forum_topics\", path: \"forum_topics.json\" },\n    { name: \"forum_topic\", path: \"forum_topics/%ID%.json\" },\n    { name: \"dtext_preview\", path: \"dtext_preview\" },\n    { name: \"iqdb_queries\", path: \"iqdb_queries.json\" },\n];\nclass APIEndpoint {\n    constructor(queue, endpoint) {\n        this.queue = queue;\n        this.path = endpoint.path;\n        this.name = endpoint.name;\n        this.node = endpoint.node;\n    }\n    /**\n     * Set an endpoint parameter, if the current endpoint allows it.\n     * For example, to GET /users/12345.json, use E621.User.spec(\"12345\").get(...);\n     * @param param\n     */\n    id(param) {\n        this.param = param + \"\";\n        return this;\n    }\n    /**\n     * Send a GET request to the endpoint\n     * @param query Request query, either as a raw string or an APIQuery\n     * @param delay Optional delay override, in milliseconds\n     */\n    get(query, delay) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.queue.createRequest(this.getParsedPath(), this.formatParam(query), \"GET\", {}, this.name, this.node, delay).then((response) => {\n                const result = this.formatData(response[0], response[2]);\n                return Promise.resolve(result);\n            }, (response) => {\n                return Promise.reject(response[0]);\n            });\n        });\n    }\n    /**\n     * Sends a GET request to the endpoint, and returns the first result found.\n     * If no results are found, returns null.\n     * @param query Request query, either as a raw string or an APIQuery\n     * @param delay Optional delay override, in milliseconds\n     */\n    first(query, delay) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.get(query, delay).then((response) => {\n                if (response.length > 0)\n                    return Promise.resolve(response[0]);\n                else\n                    return Promise.resolve(null);\n            });\n        });\n    }\n    /**\n     * Send a POST request to the endpoint\n     * @param data Data to be sent with the request\n     * @param delay Optional delay override, in milliseconds\n     */\n    post(data, delay, noEncode) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.queue.createRequest(this.getParsedPath(), {}, \"POST\", this.formatParam(data, noEncode), this.name, this.node, delay).then((data) => {\n                return Promise.resolve(data);\n            }, (error) => { return Promise.reject(error); });\n        });\n    }\n    delete(data, delay) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.queue.createRequest(this.getParsedPath(), {}, \"DELETE\", this.formatParam(data), this.name, this.node, delay).then((data) => {\n                return Promise.resolve(data);\n            }, (error) => { return Promise.reject(error); });\n        });\n    }\n    put(data, delay) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.queue.createRequest(this.getParsedPath(), {}, \"PUT\", this.formatParam(data), this.name, this.node, delay).then((data) => {\n                return Promise.resolve(data);\n            }, (error) => { return Promise.reject(error); });\n        });\n    }\n    patch(data, delay) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.queue.createRequest(this.getParsedPath(), {}, \"PATCH\", this.formatParam(data), this.name, this.node, delay).then((data) => {\n                return Promise.resolve(data);\n            }, (error) => { return Promise.reject(error); });\n        });\n    }\n    /** Returns the endpoint path, accounting for the possible parameter */\n    getParsedPath() {\n        if (this.param) {\n            const output = this.path.replace(/%ID%/g, this.param);\n            this.param = undefined; // Clear the param to avoid contaminating the next query\n            return output;\n        }\n        return this.path;\n    }\n    /**\n     * Ensures that the provided APIQuery is in the correct format.\n     * Flattens objects and arrays in order to return a list of key-value pairs.\n     * @param input APIQuery to format\n     * @param noEncode If true, the values are not URI encoded\n     */\n    formatParam(input, noEncode = false) {\n        // Debug.log(\"input\", input);\n        if (input === undefined || input === null)\n            return {};\n        const response = {};\n        for (const [key, value] of Object.entries(input)) {\n            if (value === undefined || value === null)\n                continue;\n            if (Array.isArray(value)) {\n                for (const [index, elem] of value.entries())\n                    value[index] = cleanURIComponent(elem, noEncode);\n                response[key] = value.join(\"+\");\n            }\n            else if (typeof value == \"object\") {\n                for (const [subKey, subValue] of Object.entries(value)) {\n                    if (Array.isArray(subValue)) {\n                        for (const [index, subElement] of subValue.entries())\n                            subValue[index] = cleanURIComponent(subElement, noEncode);\n                        response[`${key}[${subKey}]`] = subValue.join(\"+\");\n                    }\n                    else\n                        response[`${key}[${subKey}]`] = cleanURIComponent(subValue, noEncode);\n                }\n            }\n            else {\n                response[key] = cleanURIComponent(value, noEncode);\n            }\n        }\n        // Debug.log(\"output\", response);\n        return response;\n        /** Prevent double-encoding the values */\n        function cleanURIComponent(value, noEncode) {\n            return noEncode ? encodeURIComponent(value + \"\") : encodeURIComponent(decodeURIComponent(value + \"\"));\n        }\n    }\n    /**\n     * Returns the correct data node depending on the endpoint's definition and parameter\n     * @param data Data to select the node from\n     * @param hasParam Whether or not the endpoint had a parameter\n     */\n    formatData(data, node) {\n        if (node !== undefined)\n            data = data[node];\n        if (Array.isArray(data))\n            return data;\n        else\n            return [data];\n    }\n}\nexport class E621 {\n    /** Constructor - should be kept private */\n    constructor() {\n        //used to notify the original request function of the requests completion\n        this.emitter = $({});\n        this.processing = false;\n        this.requestIndex = 0;\n        // Endpoint Definitions\n        this.endpoints = {};\n        this.authToken = $(\"head meta[name=csrf-token]\").attr(\"content\");\n        this.queue = [];\n        ENDPOINT_DEFS.forEach((definition) => {\n            this.endpoints[definition.name] = new APIEndpoint(this, definition);\n        });\n    }\n    /**\n     * Returns an endpoint by name.\n     * Names are defined in ENDPOINT_DEFS constant\n     * @param name Endpoint name\n     */\n    static getEndpoint(name) {\n        if (this.instance === undefined)\n            this.instance = new E621();\n        return this.instance.endpoints[name];\n    }\n    /**\n     * Adds a new request to the queue based on provided data.\n     * This should only be called from endpoint get() or post() methods.\n     * @param hasParam Whether or not the endpoint had a parameter\n     * @param path Endpoint path, i.e. posts.json\n     * @param query Raw query string, i.e. ?tags=horse,male,solo\n     * @param method Request method, either GET or POST\n     * @param data Data to POST\n     * @param delay How quickly the next request can be sent, in ms\n     */\n    createRequest(path, query, method, requestBody, endpoint, node, delay) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (delay === undefined)\n                delay = E621.requestRateLimit;\n            else if (delay < 500)\n                delay = 500;\n            const requestInfo = {\n                credentials: \"include\",\n                headers: {\n                    \"Content-Type\": \"application/x-www-form-urlencoded\",\n                    \"User-Agent\": window[\"re621\"][\"useragent\"],\n                    \"X-User-Agent\": window[\"re621\"][\"useragent\"],\n                },\n                method: method,\n                mode: \"cors\",\n            };\n            if (method !== \"GET\") {\n                this.authToken = $(\"meta[name=csrf-token]\").attr(\"content\");\n                requestBody[\"authenticity_token\"] = encodeURIComponent(this.authToken);\n                requestInfo.body = FormattedAPIQuery.stringify(requestBody);\n            }\n            // Append query parameters to the URL\n            query[\"_client\"] = window[\"re621\"][\"useragent\"];\n            const entry = new Request(location.origin + \"/\" + path + \"?\" + FormattedAPIQuery.stringify(query), requestInfo);\n            // console.log(path, requestInfo);\n            const index = this.requestIndex++;\n            const final = new Promise((resolve, reject) => {\n                this.emitter.one(\"api.re621.result-\" + index, (e, data, status, endpoint, node) => {\n                    // This happens if you use find() on an item that does not exist\n                    if (data === null)\n                        data = [];\n                    // This happens if you search for an item that does not exist through a query\n                    // Posts endpoint does not count, because it is one special little snowflake.\n                    if (data[endpoint] !== undefined && ![\"posts\", \"post\"].includes(endpoint))\n                        data = [];\n                    // \"Normal\" error handling\n                    if (data[\"error\"] === undefined)\n                        resolve([data, status, node]);\n                    else\n                        reject([data, status, node]);\n                });\n            });\n            this.add({ request: entry, index: index, delay: delay, endpoint: endpoint, node: node, });\n            return final;\n        });\n    }\n    /**\n     * Adds an item to the queue and starts processing it\n     * @param newItem Item to add\n     */\n    add(newItem) {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.queue.push(newItem);\n            if (this.processing)\n                return;\n            this.processing = true;\n            while (this.queue.length > 0) {\n                const item = this.queue.shift();\n                Debug.connectLog(item.request.url);\n                yield new Promise((resolve) => __awaiter(this, void 0, void 0, function* () {\n                    fetch(item.request).then((response) => __awaiter(this, void 0, void 0, function* () {\n                        if (response.ok) {\n                            let responseText = yield response.text();\n                            if (!responseText)\n                                responseText = \"[]\";\n                            this.emitter.trigger(\"api.re621.result-\" + item.index, [\n                                JSON.parse(responseText),\n                                response.status,\n                                item.endpoint,\n                                item.node,\n                            ]);\n                        }\n                        else {\n                            this.emitter.trigger(\"api.re621.result-\" + item.index, [\n                                { error: response.status + \" \" + response.statusText },\n                                response.status,\n                                item.endpoint,\n                                item.node,\n                            ]);\n                        }\n                        resolve();\n                    }), (error) => {\n                        this.emitter.trigger(\"api.re621.result-\" + item.index, [\n                            { error: (error && error[0]) ? error[1] + \" \" + error[0].error : \"unknown error\" },\n                            (error && error[0]) ? error[1] : 500,\n                            item.endpoint,\n                            item.node,\n                        ]);\n                        resolve();\n                    });\n                }));\n                yield Util.sleep(item.delay);\n            }\n            this.processing = false;\n        });\n    }\n}\n// How often the script can send requests to the API, in milliseconds.\n// It can be as low as 500ms, but to stay on the safe side, we keep it at 1000.\nE621.requestRateLimit = 1000;\n// Endpoint Aliases\nE621.Posts = E621.getEndpoint(\"posts\");\nE621.Post = E621.getEndpoint(\"post\");\nE621.PostVotes = E621.getEndpoint(\"post_votes\");\nE621.Tags = E621.getEndpoint(\"tags\");\nE621.Tag = E621.getEndpoint(\"tag\");\nE621.TagAliases = E621.getEndpoint(\"tag_aliases\");\nE621.TagImplications = E621.getEndpoint(\"tag_implications\");\nE621.Notes = E621.getEndpoint(\"notes\");\nE621.Favorites = E621.getEndpoint(\"favorites\");\nE621.Favorite = E621.getEndpoint(\"favorite\");\nE621.Pools = E621.getEndpoint(\"pools\");\nE621.Pool = E621.getEndpoint(\"pool\");\nE621.Sets = E621.getEndpoint(\"sets\");\nE621.Set = E621.getEndpoint(\"set\");\nE621.SetAddPost = E621.getEndpoint(\"set_add_post\");\nE621.SetRemovePost = E621.getEndpoint(\"set_remove_post\");\nE621.Users = E621.getEndpoint(\"users\");\nE621.User = E621.getEndpoint(\"user\");\nE621.Blips = E621.getEndpoint(\"blips\");\nE621.Wiki = E621.getEndpoint(\"wiki_pages\");\nE621.Comments = E621.getEndpoint(\"comments\");\nE621.Comment = E621.getEndpoint(\"comment\");\nE621.ForumPosts = E621.getEndpoint(\"forum_posts\");\nE621.ForumPost = E621.getEndpoint(\"forum_post\");\nE621.ForumTopics = E621.getEndpoint(\"forum_topics\");\nE621.ForumTopic = E621.getEndpoint(\"forum_topic\");\nE621.DTextPreview = E621.getEndpoint(\"dtext_preview\");\nE621.IQDBQueries = E621.getEndpoint(\"iqdb_queries\");\nvar FormattedAPIQuery;\n(function (FormattedAPIQuery) {\n    function stringify(input) {\n        const result = [];\n        for (const [key, value] of Object.entries(input))\n            result.push(key + \"=\" + value);\n        return result.join(\"&\");\n    }\n    FormattedAPIQuery.stringify = stringify;\n})(FormattedAPIQuery || (FormattedAPIQuery = {}));\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { E621 } from \"../api/E621\";\n/**\n * User\n * Basic framework for fetching user information from the page metadata\n */\nexport default class User {\n    static init() {\n        const data = $(\"body\").data();\n        User.loggedIn = data.userIsAnonymous == false;\n        User.username = data.userName || \"Anonymous\";\n        User.userID = data.userId || -1;\n        User.level = data.userLevel || 0;\n        User.levelString = data.userLevelString || \"Anonymous\";\n        User.isMember = data.userIsMemeber == true;\n        User.isPrivileged = data.userIsPrivileged == true;\n        User.isContributor = data.userIsContributor == true;\n        User.isJanitor = data.userIsJanitor == true;\n        User.isModerator = data.userIsModerator == true;\n        User.isAdmin = data.userIsAdmin == true;\n        User.isFormerStaff = data.userIsFormerStaff == true;\n        User.isVoter = data.userIsVoter == true;\n        User.isVerified = data.userIsVerified == true;\n        User.isApprover = data.userIsApprover == true;\n        User.isBlocked = data.userIsBlocked == true;\n        User.isBanned = data.userIsBanned == true;\n        User.canApprovePosts = data.userCanApprovePosts == true;\n        User.canUploadFree = data.userCanUploadFree == true;\n        User.postsPerPage = data.userPerPage || 75;\n        User.commentThreshold = parseInt(getValue(\"user-comment-threshold\")) || 3;\n        User.blacklistedTags = getValue(\"blacklisted-tags\");\n        User.blacklistUsers = getValue(\"blacklist-users\") == \"true\";\n        User.enableJSNavigation = getValue(\"enable-js-navigation\") == \"true\";\n        User.enableAutoComplete = getValue(\"enable-auto-complete\") == \"true\";\n        User.styleUsernames = getValue(\"style-usernames\") == \"true\";\n        User.defaultImageSize = ImageScalingMode.get(getValue(\"default-image-size\"));\n        function getValue(name) {\n            const el = $(`meta[name=\"${name}\"]`);\n            if (el.length == 0)\n                return null;\n            return el.attr(\"content\");\n        }\n    }\n    /**\n     * @returns the users e6 site settings\n     */\n    static getCurrentSettings() {\n        return __awaiter(this, void 0, void 0, function* () {\n            return E621.User.id(User.userID).first();\n        });\n    }\n    /**\n     * Saves the settings for the user\n     * There is no need to put the keys into array form, this happens automatically\n     */\n    static setSettings(data) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield E621.User.id(this.userID).post({ user: data, \"_method\": \"patch\" });\n        });\n    }\n}\nexport var ImageScalingMode;\n(function (ImageScalingMode) {\n    ImageScalingMode[\"Sample\"] = \"large\";\n    ImageScalingMode[\"FitHeight\"] = \"fitv\";\n    ImageScalingMode[\"FitWidth\"] = \"fit\";\n    ImageScalingMode[\"Original\"] = \"original\";\n})(ImageScalingMode || (ImageScalingMode = {}));\n(function (ImageScalingMode) {\n    function get(mode) {\n        switch (mode) {\n            case \"large\": return ImageScalingMode.Sample;\n            case \"fitv\": return ImageScalingMode.FitHeight;\n            case \"fit\": return ImageScalingMode.FitWidth;\n            case \"original\": return ImageScalingMode.Original;\n        }\n        return ImageScalingMode.Sample;\n    }\n    ImageScalingMode.get = get;\n})(ImageScalingMode || (ImageScalingMode = {}));\n","export default class Page {\n    constructor() {\n        this.url = new URL(window.location.toString());\n    }\n    /**\n     * Checks if the url the user is currently on satisfies the filter\n     * @param filter Pipe separated list of filters the current location has to satisfy\n     *               Matches are by default on a startsWith basis, but if the url must match\n     *               you can prepend =\n     * @returns true if at least on filter is fulfilled\n     */\n    static matches(filter) {\n        if (filter instanceof RegExp)\n            filter = [filter];\n        const pathname = this.getInstance().url.pathname.replace(/[/?]$/g, \"\");\n        let result = false;\n        filter.forEach(function (constraint) {\n            result = result || constraint.test(pathname);\n        });\n        return result;\n    }\n    /** Returns a URL object */\n    static getURL() {\n        return this.getInstance().url;\n    }\n    /**\n     * Returns the query parameter, or null if the key does not exist\n     * @return string Query parameter\n     */\n    static getQueryParameter(key) {\n        return this.getInstance().url.searchParams.get(key);\n    }\n    /**\n     * Returns true if the search parameters has the provided key, false otherwise\n     * @param key\n     */\n    static hasQueryParameter(key) {\n        return this.getInstance().url.searchParams.has(key);\n    }\n    /**\n     * Sets a query parameter in the current url\n     * If there is already one with the same key, it will get overridden\n     * @param key\n     * @param value\n     */\n    static setQueryParameter(key, value) {\n        this.getInstance().url.searchParams.set(key, value);\n        this.refreshCurrentUrl();\n    }\n    /**\n     * Removes a querystring from the url\n     */\n    static removeQueryParameter(keys) {\n        if (!Array.isArray(keys))\n            keys = [keys];\n        for (const key of keys)\n            this.getInstance().url.searchParams.delete(key);\n        this.refreshCurrentUrl();\n    }\n    /**\n     * Replaces the current url without reloading or pushing the old one to the history\n     */\n    static refreshCurrentUrl() {\n        const url = this.getInstance().url;\n        const searchPrefix = url.searchParams.toString().length === 0 ? \"\" : \"?\";\n        history.replaceState({}, \"\", url.origin + url.pathname + searchPrefix + url.searchParams.toString() + url.hash);\n    }\n    /**\n     * Returns the name of the current site\n     * @returns e621 or e926\n     */\n    static getSiteName() {\n        return this.getInstance().url.hostname.replace(/\\.net/g, \"\");\n    }\n    /**\n     * Returns the ID from the second part of the pathname\n     */\n    static getPageID() {\n        return this.getInstance().url.pathname.split(\"/\")[2];\n    }\n    /**\n     * Returns a singleton instance of the class\n     * @returns Url instance\n     */\n    static getInstance() {\n        if (this.instance === undefined)\n            this.instance = new Page();\n        return this.instance;\n    }\n    /**\n     * Returns the type of the page, according to the definitions below\n     * @returns Page type, as a string\n     */\n    static getPageType() {\n        for (const [name, regex] of Object.entries(PageDefinition))\n            if (Page.matches(regex))\n                return name;\n        return null;\n    }\n}\nexport const PageDefinition = {\n    title: /^(\\/)?$/,\n    search: /^\\/posts\\/?$/,\n    post: /^\\/posts\\/\\d+\\/?(show_seq)?$/,\n    upload: /\\/uploads\\/new\\/?/,\n    forum: /^\\/forum_topics\\/?.*/,\n    forumPost: /^\\/forum_topics\\/\\d+.*/,\n    pool: /^\\/pools\\/.+/,\n    set: /^\\/post_sets\\/.+/,\n    popular: /^\\/explore\\/posts\\/popular.?/,\n    favorites: /^\\/favorites\\/?.*/,\n    wiki: /^\\/wiki_pages\\/[0-9]+/,\n    wikiNA: /^\\/wiki_pages\\/show_or_new.*/,\n    artist: /^\\/artists\\/[0-9]+/,\n    comments: /^\\/comments\\??.*/,\n    settings: /^\\/users\\/\\.+\\/edit$/,\n    changes: /^\\/post_versions.*/,\n    tickets: /^\\/tickets.*/,\n    profile: /^\\/users\\/.+$/,\n    iqdb: /^\\/iqdb_queries.*/,\n    deleted_posts: /^\\/deleted_posts.*/,\n    blips: /^\\/blips.*/,\n    help: /^\\/help.*/,\n    postConfirmDelete: /^\\/moderator\\/post\\/posts\\/.+\\/confirm_delete.*/,\n};\n","import Page from \"../data/Page\";\nimport Util from \"../utility/Util\";\nexport default class DOMTools {\n    /**\n     * Adds the given style to the document and returns the injected style element\n     * @param css string CSS styles\n     */\n    static addStyle(css) {\n        return $(\"<style>\")\n            .attr({\n            \"id\": Util.ID.make(),\n            \"type\": \"text/css\"\n        })\n            .html(css)\n            .appendTo(\"head\");\n    }\n    static patchHeader() {\n        const $menuContainer = $(\"nav#nav\");\n        const $menuMain = $(\"menu.main\");\n        if ($(\"#nav\").find(\"menu\").length < 2) {\n            $(\"<menu>\")\n                .addClass(\"subnav\")\n                .appendTo($menuContainer);\n        }\n        else\n            $(\"#nav menu\").last().addClass(\"subnav\");\n        // Replace the logo in menu.main with a separate element\n        $(\"<menu>\")\n            .addClass(\"logo\")\n            .html(`<a href=\"/\">${Page.getSiteName()}</a>`)\n            .prependTo($menuContainer);\n        $menuMain.find(\"#nav-e\").remove();\n        // Add a section for re621 settings buttons\n        $(\"<menu>\")\n            .addClass(\"extra\")\n            .insertAfter($menuMain);\n    }\n    static setupDialogContainer() {\n        $(\"<div>\")\n            .attr(\"id\", \"modal-container\")\n            .prependTo(\"body\");\n    }\n    /**\n     * Adds a button to the top-right of the navbar\n     * @param config Button configuration\n     * @param target Target element\n     */\n    static addSettingsButton(config, target = \"menu.extra\") {\n        if (config.name === undefined)\n            config.name = \"T\";\n        if (config.href === undefined)\n            config.href = \"\";\n        if (config.title === undefined)\n            config.title = \"\";\n        if (config.tabClass === undefined)\n            config.tabClass = \"\";\n        if (config.linkClass === undefined)\n            config.linkClass = \"\";\n        if (config.attr === undefined)\n            config.attr = {};\n        const $tab = $(`<li>`).appendTo(target);\n        const $link = $(\"<a>\")\n            .html(config.name)\n            .attr({\n            \"title\": config.title,\n            \"id\": config.id,\n        })\n            .appendTo($tab);\n        if (config.onClick !== undefined)\n            $link.on(\"click\", () => { config.onClick($link); });\n        if (config.href) {\n            $link.attr(\"href\", config.href);\n        }\n        if (config.tabClass) {\n            $tab.addClass(config.tabClass);\n        }\n        if (config.linkClass) {\n            $link.addClass(config.linkClass);\n        }\n        if (config.attr) {\n            $link.attr(config.attr);\n        }\n        return $link;\n    }\n}\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nexport default class PageObserver {\n    /**\n     * Initialize the observer and start watching for DOM changes.\n     * Should be executed as soon as possible\n     */\n    static init() {\n        if (this.observer && this.targets)\n            return;\n        // Watch for the elements to load\n        this.targets = new Map();\n        this.observer = new MutationObserver(() => {\n            for (const [selector, callback] of Array.from(this.targets.entries())) {\n                if (!document.querySelector(selector))\n                    continue;\n                this.targets.delete(selector);\n                callback(true);\n            }\n        });\n        this.observer.observe(document, { childList: true, subtree: true });\n        // Clean up after the page loads\n        $(() => {\n            this.observer.disconnect();\n            this.pageLoaded = true;\n            for (const callback of Array.from(this.targets.values()))\n                callback(false);\n            this.targets = new Map();\n        });\n    }\n    /**\n     * Waits for the DOM element to load in.\n     * Returns a promise that resolves to true if the element is found,\n     * and to false if the page fully loads without encountering the element.\n     * @param selector Element to search for\n     * @returns Promise\n     */\n    static watch(selector) {\n        if ($(selector).length > 0)\n            return Promise.resolve(true);\n        else if (this.pageLoaded)\n            return Promise.resolve(false);\n        return new Promise((resolve) => {\n            this.targets.set(selector, resolve);\n        });\n    }\n    /** Returns a promise that gets resolved if and when the window is visible on the screen */\n    static awaitFocus() {\n        return __awaiter(this, void 0, void 0, function* () {\n            return new Promise((resolve) => {\n                // Document either has direct user focus, or is generally visible on the screen\n                if (document.hasFocus() || document.visibilityState == \"visible\") {\n                    resolve(true);\n                    return;\n                }\n                // Window receives focus\n                $(window).one(\"focus\", () => resolve(true));\n            });\n        });\n    }\n}\nPageObserver.pageLoaded = false;\n","import XM from \"../components/api/XM\";\nexport default class Script {\n}\nScript.version = XM.Info.script.version;\nScript.handler = {\n    name: XM.Info.scriptHandler,\n    version: XM.Info.version,\n};\nScript.url = {\n    website: \"https://re621.bitwolfy.com/\",\n    repo: \"https://github.com/re621/re621/\",\n    issues: \"https://github.com/re621/re621/issues\",\n    thread: \"https://e621.net/forum_topics/25872\",\n    latest: \"https://api.github.com/repos/re621/re621/releases/latest\",\n};\n","import Util from \"../utility/Util\";\nexport default class Modal {\n    constructor(config) {\n        // private config: ModalConfig;\n        this.triggers = [];\n        this.isDisabled = false;\n        this.id = Util.ID.make();\n        config = this.validateConfig(config);\n        this.triggersMulti = config.triggerMulti;\n        this.isDisabled = config.disabled;\n        // Create the DOM structure for the modal window\n        this.$modal = $(\"<div>\")\n            .attr(\"title\", config.title)\n            .append(config.content)\n            .dialog({\n            autoOpen: config.autoOpen,\n            appendTo: \"#modal-container\",\n            resizable: false,\n            width: \"auto\",\n            minWidth: config.minWidth,\n            minHeight: config.minHeight,\n            position: {\n                my: config.position.my,\n                at: config.position.at,\n                of: \"#modal-container\",\n                within: \"#modal-container\",\n                // collision: \"none\",\n            },\n            classes: {\n                \"ui-dialog\": \"bg-foreground border-section color-text\",\n                \"ui-dialog-titlebar\": \"color-text\",\n                \"ui-dialog-titlebar-close\": \"border-foreground\",\n            }\n        });\n        const ui = this.$modal.closest('.ui-dialog');\n        ui.draggable('option', 'containment', '#modal-container');\n        // Replace the modal structure on window open, if necessary\n        if (config.structure)\n            this.$modal.one(\"dialogopen.lazyload\", () => {\n                this.$modal.html(\"\");\n                this.$modal.append(config.structure.render());\n            });\n        this.registerTrigger(config.triggers);\n    }\n    enable() { this.isDisabled = false; }\n    disable() { this.isDisabled = true; }\n    get isOpen() { return this.$modal.dialog(\"isOpen\"); }\n    set isOpen(open) { this.$modal.dialog(open ? \"open\" : \"close\"); }\n    open() { this.isOpen = true; }\n    close() { this.isOpen = false; }\n    toggle() { this.isOpen = !this.isOpen; }\n    /**\n     * Parses the configuration and sets the default values for missing entries\n     * @param config Configuration to parse\n     */\n    validateConfig(config) {\n        const result = {};\n        result.title = typeof config.title === \"undefined\" ? \"Dialog\" : config.title;\n        result.autoOpen = typeof config.autoOpen === \"undefined\" ? false : config.autoOpen;\n        result.triggers = typeof config.triggers === \"undefined\" ? [] : config.triggers;\n        result.triggerMulti = typeof config.triggerMulti === \"undefined\" ? false : config.triggerMulti;\n        result.content = typeof config.content === \"undefined\" ? $(\"\") : config.content;\n        result.structure = typeof config.structure === \"undefined\" ? null : config.structure;\n        result.minWidth = typeof config.minWidth === \"undefined\" ? 150 : config.minWidth;\n        result.minHeight = typeof config.minHeight === \"undefined\" ? 150 : config.minHeight;\n        result.disabled = typeof config.disabled === \"undefined\" ? false : config.disabled;\n        if (typeof config.position === \"undefined\")\n            result.position = { my: \"center\", at: \"center\" };\n        else\n            result.position = {\n                my: !config.position.my ? \"center\" : config.position.my,\n                at: !config.position.at ? \"center\" : config.position.at,\n            };\n        return result;\n    }\n    /**\n     * Appends more content to the modal\n     * @param $content Content to add\n     */\n    addContent($content) {\n        this.$modal.append($content);\n    }\n    /**\n     * Sets the modal content\n     * @param $content Content to add\n     */\n    setContent($content) {\n        this.$modal.html(\"\");\n        this.$modal.append($content);\n    }\n    /**\n     * Listens to the specified element in order to trigger the modal\n     * @param trigger Element-event pair to listen to\n     */\n    registerTrigger(trigger) {\n        if (!trigger)\n            return;\n        else if (Array.isArray(trigger)) {\n            for (const one of trigger)\n                this.registerTrigger(one);\n            return;\n        }\n        if (typeof trigger.event === \"undefined\")\n            trigger.event = \"click\";\n        if (this.triggers.length == 0)\n            this.activeTrigger = trigger.element;\n        this.triggers.push(trigger);\n        trigger.element.on(trigger.event + \".re621.dialog-\" + this.id, (event) => {\n            if (this.isDisabled)\n                return;\n            event.preventDefault();\n            const $target = $(event.currentTarget);\n            if (this.triggersMulti && !this.activeTrigger.is($target) && this.isOpen) {\n                this.toggle(); // TODO Update the modal window instead of toggling\n            }\n            this.activeTrigger = $target;\n            this.toggle();\n            return false;\n        });\n    }\n    clearTriggers() {\n        for (const trigger of this.triggers)\n            trigger.element.off(trigger.event + \".re621.dialog-\" + this.id);\n        this.triggers = [];\n    }\n    getElement() { return this.$modal; }\n    /**\n     * Completely and irreversibly destroys the modal window\n     */\n    destroy() {\n        this.$modal.dialog(\"destroy\");\n        this.$modal.remove();\n    }\n    /**\n     * Returns the element that triggered the modal\n     * @returns JQuery<HTMLElement> trigger\n     */\n    getActiveTrigger() {\n        return this.activeTrigger;\n    }\n}\nModal.isReady = false;\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport Script from \"../../models/Script\";\nimport Modal from \"../structure/Modal\";\nimport PageObserver from \"../structure/PageObserver\";\nexport default class ErrorHandler {\n    static log(module, message, error) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const notice = $(\"<div>\").html([\n                `<p>RE621 had encountered an error during script execution.</p>`,\n                `<p>Please, report this message, including the error log below, through the <a href=\"${Script.url.issues}\">issue tracker</a>, or in the <a href=\"${Script.url.thread}\">forum thread</a>.</p>`,\n            ].join(\"\\n\"));\n            const textarea = $(\"<textarea>\").val([\n                `RE621 v.${Script.version} for ${Script.handler.name} v.${Script.handler.version}`,\n                window.navigator.userAgent,\n                message,\n                (error && error.stack) ? error.stack : error,\n            ].join(\"\\n\"));\n            console.error([\n                \"[ErrorHandler]\",\n                notice.text().trim(),\n                (textarea.val() + \"\").trim(),\n            ].join(\"\\n\"));\n            if (!Modal.isReady)\n                yield PageObserver.watch(\"modal-container\");\n            const dialog = new Modal({\n                title: \"Error\",\n                autoOpen: true,\n                // width: window.innerWidth / 2,\n                // height: window.innerHeight / 2,\n                // minWidth: 400,\n                // minHeight: 400,\n                // maxWidth: 800,\n                // maxHeight: 600,\n            });\n            dialog.getElement()\n                .addClass(\"error-handler\")\n                .append(notice)\n                .append(textarea);\n        });\n    }\n}\n","import Debug from \"../utility/Debug\";\nimport Util from \"../utility/Util\";\nconst validKeys = [\n    \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"0\",\n    \"-\", \"=\", \".\", \",\", \"/\", \";\", \"'\", \"[\", \"]\",\n    \"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"l\", \"m\", \"n\", \"o\", \"p\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\",\n    \"escape\", \"ctrl\", \"alt\", \"shift\", \"return\",\n    \"up\", \"down\", \"left\", \"right\",\n];\nconst replacedKeys = {\n    // event.key returns a different name to what jquery.hotkeys expects\n    \"enter\": \"return\",\n    \"control\": \"ctrl\",\n    \"arrow\": \"\",\n    // replacing shift-modified symbols with respective values\n    // it makes no practical difference, but it looks neater\n    \"!\": \"1\", \"@\": \"2\", \"#\": \"3\", \"$\": \"4\", \"%\": \"5\",\n    \"^\": \"6\", \"&\": \"7\", \"*\": \"8\", \"(\": \"9\", \")\": \"0\",\n    \"_\": \"-\", \"+\": \"=\", \"<\": \",\", \">\": \".\", \"?\": \"//\",\n    \":\": \";\", '\"': \"'\", \"{\": \"[\", \"}\": \"]\",\n};\nconst replacedRegExp = Util.getKeyRegex(replacedKeys);\nexport default class KeybindManager {\n    static enable() { KeybindManager.enabled = true; }\n    static disable() { KeybindManager.enabled = false; }\n    static block() { KeybindManager.blocked = true; }\n    static register(keybind) {\n        if (KeybindManager.blocked)\n            return;\n        if (Array.isArray(keybind)) {\n            for (const entry of keybind)\n                this.register(entry);\n            return;\n        }\n        // Create a listener if one does not exist already\n        this.refreshListener(keybind.keys, keybind.element, keybind.selector);\n        // Register the keybind function in the executor\n        for (const key of keybind.keys) {\n            if (key.length == 0)\n                continue;\n            this.executors.get(key)[keybind.bindMeta] = keybind;\n        }\n    }\n    static unregister(bindMeta) {\n        if (!Array.isArray(bindMeta))\n            bindMeta = [bindMeta];\n        for (const executor of this.executors.values())\n            for (const key of Object.keys(executor))\n                if (bindMeta.includes(key))\n                    delete executor[key];\n    }\n    static record(callback) {\n        KeybindManager.listening = true;\n        let keys = [];\n        $(document).on(\"keydown.re621.record\", (event) => {\n            const key = event.key\n                .toLowerCase()\n                .replace(replacedRegExp, (matched) => {\n                return replacedKeys[matched];\n            });\n            if (validKeys.indexOf(key) == -1)\n                return;\n            keys.push(key);\n        });\n        $(document).on(\"keyup.re621.record\", () => {\n            if (keys.length !== 0) {\n                $(document).off(\".re621.record\");\n                callback(keys);\n                KeybindManager.listening = false;\n                return;\n            }\n            keys = [];\n        });\n    }\n    static count(sequence) {\n        if (!this.executors.has(sequence))\n            return 0;\n        return Object.keys(this.executors.get(sequence)).length;\n    }\n    static refreshListener(keys, element, selector) {\n        for (const key of keys) {\n            if (key.length == 0)\n                continue;\n            // Establish the listener structure\n            if (!this.listeners.has(key)) {\n                let keydown = false;\n                this.listeners.set(key, (event) => {\n                    if (KeybindManager.listening)\n                        return;\n                    const listenerExecutor = this.executors.get(key);\n                    Debug.log(`[${key}]: triggered ${Object.entries(listenerExecutor).length} executors`);\n                    for (const [bindMeta, keyObj] of Object.entries(listenerExecutor)) {\n                        // If the keybind is outright disable, skip\n                        if (!keyObj.enabled)\n                            continue;\n                        // This is a dumb solution, but it'll work for the time being\n                        // The issue is that any keybind can be made holdable by binding it\n                        // to a the same key as an already holdable key. This may allow\n                        // people to spam certain actions.\n                        if (keyObj.holdable)\n                            keydown = false;\n                        // Execute the keybind function\n                        keyObj.fnct(event, bindMeta);\n                    }\n                });\n                // Create the listener itself\n                const $element = element ? $(element) : $(document);\n                if (!selector)\n                    selector = null;\n                let cooldown = null;\n                $element.on(\"keydown.re621.hotkey-\" + key, selector, key, (event) => {\n                    if (keydown)\n                        return;\n                    if (cooldown)\n                        return;\n                    keydown = true;\n                    if (!KeybindManager.enabled || KeybindManager.listening)\n                        return false;\n                    Debug.log(`[${key}]: caught`);\n                    this.listeners.get(key)(event);\n                    // Slightly throttles the keystroke input speed\n                    // Should only be an issue with holdable keybinds\n                    clearTimeout(cooldown);\n                    cooldown = setTimeout(() => {\n                        clearTimeout(cooldown);\n                        cooldown = null;\n                    }, 50);\n                });\n                $element.on(\"keyup.re621.hotkey-\" + key, selector, key, () => {\n                    keydown = false;\n                });\n                $(window).on(\"blur\", () => {\n                    keydown = false;\n                });\n            }\n            // Create the executor\n            if (!this.executors.has(key))\n                this.executors.set(key, {});\n        }\n    }\n}\nKeybindManager.listeners = new Map();\nKeybindManager.executors = new Map();\nKeybindManager.enabled = true; // if false, stops executor functions from running\nKeybindManager.blocked = false; // if true, stops listener functions from being created\nKeybindManager.listening = false; // same as enabled, but for internal use only\n","import XM from \"../api/XM\";\nimport KeybindManager from \"../data/Keybinds\";\nimport Util from \"../utility/Util\";\n/**\n * Form Engine v.2.0\n * Simplifies the process of creating complex, visually consistent forms.\n */\nexport class Form {\n    /**\n     * Prepares the form structure and settings.\n     * Use `get()` to return an actual DOM element.\n     * @param options Form options\n     * @param content Form elements\n     * @param onSubmit Form submission callback\n     */\n    constructor(options, content, onSubmit) {\n        if (!options.name)\n            options.name = Util.ID.make();\n        if (!options.columns)\n            options.columns = 1;\n        if (!options.width)\n            options.width = options.columns;\n        this.element = $(\"<form>\")\n            .addClass(\"form-section\" + (options.wrapper ? \" \" + options.wrapper : \"\"))\n            .attr({\n            \"id\": options.name,\n            \"columns\": options.columns !== 1 ? options.columns : null,\n            \"formspan\": options.width !== 1 ? options.width : null,\n        })\n            .on(\"submit\", (event) => {\n            event.preventDefault();\n            const values = {};\n            this.inputList.forEach((input, name) => {\n                if (input.attr(\"type\") == \"checkbox\")\n                    values[name] = input.is(\":checked\");\n                else\n                    values[name] = input.val().toString();\n            });\n            onSubmit(values, this);\n        });\n        this.content = content;\n        this.inputList = new Map();\n    }\n    /**\n     * Builds and returns the form DOM element\n     * @param force If true, ignores any cached data and rebuilds the structure from scratch\n     */\n    render(force = false) {\n        if (this.created && !force) {\n            return this.element;\n        }\n        // Build form elements\n        this.element[0].innerHTML = \"\";\n        const formID = this.element.attr(\"id\");\n        for (const entry of this.content) {\n            for (const childElem of entry.build(formID, force))\n                childElem.appendTo(this.element);\n        }\n        // Compile input lists\n        for (const entry of this.content) {\n            for (const input of entry.getInputs()) {\n                const name = input.attr(\"name\");\n                if (name !== undefined)\n                    this.inputList.set(name, input);\n            }\n        }\n        // Return the form element\n        this.created = true;\n        return this.element;\n    }\n    /**\n     * Resets the elements to their default values.\n     * Does not include buttons and submit elements\n     */\n    reset() {\n        this.inputList.forEach((input) => {\n            const defval = input.attr(\"defval\");\n            if (defval !== undefined) {\n                if (input.attr(\"type\") == \"checkbox\")\n                    input.prop(\"checked\", defval == \"true\");\n                else\n                    input.val(defval);\n            }\n        });\n    }\n    /**\n     * Returns a list of elements in the form.\n     * If no parameter is specified, returns all inputs\n     * @param names Names of inputs to return\n     */\n    getInputList(...names) {\n        if (names.length == 0) {\n            return this.inputList;\n        }\n        const results = new Map();\n        this.inputList.forEach((input, name) => {\n            if (names.includes(name))\n                results.set(name, input);\n        });\n        return results;\n    }\n    /**\n     * An empty, placeholder form. Used to properly space out and center modals\n     * @param width Form width\n     */\n    static placeholder(width = 1) {\n        return new Form({ columns: width, width: width }, [Form.spacer(width)]).render();\n    }\n    /**\n     * Creates a form section FormElement based on the provided parameters\n     * @param options Section configuration\n     * @param content Form elements\n     */\n    static section(options, content) {\n        if (!options.name)\n            options.name = Util.ID.make();\n        if (!options.columns)\n            options.columns = 1;\n        if (!options.width)\n            options.width = options.columns;\n        let $label;\n        if (options.label)\n            $label = FormUtils.makeLabel(options.name, options.label);\n        const $element = $(\"<form-section>\")\n            .toggleClass(options.wrapper, options.wrapper)\n            .attr({\n            \"id\": options.name,\n            \"labeled\": options.label !== undefined ? \"\" : null,\n            \"columns\": options.columns !== 1 ? options.columns : null,\n            \"colspan\": options.width !== 1 ? options.width : null,\n        });\n        return new FormElement($element, undefined, $label, content);\n    }\n    /**\n     * Creates a collapsible section FormElement based on the provided parameters\n     * @param options Section configuration\n     * @param content Form elements\n     */\n    static accordion(options, content) {\n        if (!options.name)\n            options.name = Util.ID.make();\n        if (!options.columns)\n            options.columns = 1;\n        if (!options.width)\n            options.width = options.columns;\n        let $label;\n        if (options.label)\n            $label = FormUtils.makeLabel(options.name, options.label);\n        const $element = $(\"<form-accordion>\")\n            .toggleClass(options.wrapper, options.wrapper)\n            .attr({\n            \"id\": options.name,\n            \"labeled\": options.label !== undefined ? \"\" : null,\n            \"columns\": options.columns !== 1 ? options.columns : null,\n            \"colspan\": options.width !== 1 ? options.width : null,\n        });\n        return new FormElement($element, undefined, $label, content, undefined, (postElement) => {\n            postElement.accordion({\n                active: options.active,\n                animate: false,\n                collapsible: options.collapsible === true,\n                header: \"form-header\",\n            });\n            // Accordions fail to properly show visible elements\n            postElement.find(\"form-section[aria-hidden=false]\").css(\"display\", \"\");\n        });\n    }\n    static accordionTab(options, content) {\n        if (!options.name)\n            options.name = Util.ID.make();\n        if (!options.columns)\n            options.columns = 1;\n        if (!options.width)\n            options.width = options.columns;\n        const $label = $(\"<form-header>\")\n            .attr(\"for\", options.name)\n            .html(options.label || \"TITLE_ERROR\");\n        if (options.subheader)\n            $(\"<span>\")\n                .addClass(\"form-collapse-subheader\")\n                .append(options.subheader)\n                .appendTo($label);\n        if (options.badge)\n            $(\"<span>\")\n                .addClass(\"form-collapse-badge\")\n                .append(options.badge)\n                .appendTo($label);\n        const $element = $(\"<form-section>\")\n            .addClass(\"collapse-content\")\n            .attr({\n            \"id\": options.name,\n            \"labeled\": options.label !== undefined ? \"\" : null,\n            \"columns\": options.columns !== 1 ? options.columns : null,\n            \"colspan\": options.width !== 1 ? options.width : null,\n        });\n        return new FormElement($element, undefined, $label, content);\n    }\n    /**\n     * Creates a collapsible section FormElement based on the provided parameters\n     * @param options Section configuration\n     * @param content Form elements\n     */\n    static collapse(options, content, onActivate) {\n        if (!options.name)\n            options.name = Util.ID.make();\n        if (!options.columns)\n            options.columns = 1;\n        if (!options.width)\n            options.width = options.columns;\n        let $label;\n        if (options.label)\n            $label = FormUtils.makeLabel(options.name, options.label);\n        const $element = $(\"<form-collapse>\")\n            .attr({\n            \"id\": options.name,\n            \"colspan\": options.width || 1,\n        });\n        const header = $(\"<h3>\")\n            .addClass(\"collapse-header\")\n            .html(options.title || \"Details\")\n            .appendTo($element);\n        if (options.badge)\n            $(\"<span>\")\n                .addClass(\"form-collapse-badge\")\n                .append(options.badge)\n                .appendTo(header);\n        const container = $(\"<form-section>\")\n            .addClass(\"collapse-content\")\n            .attr({\n            \"labeled\": options.label !== undefined ? \"\" : null,\n            \"columns\": options.columns !== 1 ? options.columns : null,\n            \"colspan\": options.width !== 1 ? options.width : null,\n        })\n            .appendTo($element);\n        $element.accordion({\n            active: !options.collapsed,\n            animate: false,\n            collapsible: true,\n            header: \"h3\",\n            beforeActivate: () => {\n                if (onActivate == undefined)\n                    return;\n                onActivate(header.attr(\"id\"), header.attr(\"aria-expanded\") == \"true\");\n            },\n        });\n        return new FormElement($element, undefined, $label, content, container);\n    }\n    /**\n     * Creates an input FormElement based on the provided parameters\n     * @param options Element configuration\n     * @param changed Input change callback\n     */\n    static input(options, changed) {\n        if (!options.name)\n            options.name = Util.ID.make();\n        let $label;\n        if (options.label)\n            $label = FormUtils.makeLabel(options.name, options.label);\n        const $element = FormUtils\n            .makeInputWrapper(options.label, options.wrapper, options.width);\n        const $input = $(\"<input>\")\n            .attr({\n            \"type\": \"text\",\n            \"id\": options.name,\n            \"name\": options.name,\n        })\n            .addClass(\"bg-section color-text\")\n            .prop(\"disabled\", options.disabled == true)\n            .appendTo($element);\n        if (options.value !== undefined && options.value !== null) {\n            switch (typeof options.value) {\n                case \"function\": {\n                    options.value($input);\n                    break;\n                }\n                case \"object\": {\n                    $input.val(options.value.text());\n                    break;\n                }\n                case \"boolean\":\n                    options.value = options.value + \"\";\n                default: {\n                    $input\n                        .val(options.value)\n                        .attr(\"defval\", options.value);\n                }\n            }\n        }\n        if (options.title)\n            $input.attr(\"title\", options.title);\n        if (options.pattern)\n            $input.attr(\"pattern\", options.pattern);\n        if (options.required)\n            $input.attr(\"required\", '');\n        if (changed !== undefined) {\n            let timer;\n            $input.on(\"input\", () => {\n                if (timer)\n                    clearTimeout(timer);\n                timer = window.setTimeout(() => { changed($input.val().toString(), $input); }, Form.inputTimeout);\n            });\n        }\n        return new FormElement($element, $input, $label);\n    }\n    /**\n     * Creates an input FormElement based on the provided parameters\n     * @param options Element configuration\n     * @param changed Input change callback\n     */\n    static textarea(options, changed) {\n        if (!options.name)\n            options.name = Util.ID.make();\n        let $label;\n        if (options.label)\n            $label = FormUtils.makeLabel(options.name, options.label);\n        const $element = FormUtils\n            .makeInputWrapper(options.label, options.wrapper, options.width);\n        const $input = $(\"<textarea>\")\n            .attr({\n            \"type\": \"text\",\n            \"id\": options.name,\n            \"name\": options.name,\n        })\n            .addClass(\"bg-section color-text\")\n            .prop(\"disabled\", options.disabled == true)\n            .appendTo($element);\n        if (options.value !== undefined && options.value !== null) {\n            switch (typeof options.value) {\n                case \"function\": {\n                    options.value($input);\n                    break;\n                }\n                case \"object\": {\n                    $input.val(options.value.text());\n                    break;\n                }\n                case \"boolean\":\n                    options.value = options.value + \"\";\n                default: {\n                    $input\n                        .val(options.value)\n                        .attr(\"defval\", options.value);\n                }\n            }\n        }\n        if (options.title)\n            $input.attr(\"title\", options.title);\n        if (options.pattern)\n            $input.attr(\"pattern\", options.pattern);\n        if (options.required)\n            $input.attr(\"required\", '');\n        if (changed !== undefined) {\n            let timer;\n            $input.on(\"input\", () => {\n                if (timer)\n                    clearTimeout(timer);\n                timer = window.setTimeout(() => { changed($input.val().toString(), $input); }, Form.inputTimeout);\n            });\n        }\n        return new FormElement($element, $input, $label);\n    }\n    /**\n     * Creates a copy input FormElement based on the provided parameters\n     * @param options Element configuration\n     */\n    static copy(options) {\n        if (!options.name)\n            options.name = Util.ID.make();\n        let $label;\n        if (options.label)\n            $label = FormUtils.makeLabel(options.name, options.label);\n        const $element = FormUtils\n            .makeInputWrapper(options.label, options.wrapper, options.width)\n            .addClass(\"copybox\");\n        const $input = $(\"<input>\")\n            .attr({\n            \"type\": \"text\",\n            \"id\": options.name,\n            \"readonly\": \"\",\n        })\n            .addClass(\"bg-section color-text\")\n            .appendTo($element);\n        if (options.value !== undefined && options.value !== null) {\n            switch (typeof options.value) {\n                case \"function\": {\n                    options.value($input);\n                    break;\n                }\n                case \"object\": {\n                    $input.val(options.value.text());\n                    break;\n                }\n                case \"boolean\":\n                    options.value = options.value + \"\";\n                default: {\n                    $input\n                        .val(options.value)\n                        .attr(\"defval\", options.value);\n                }\n            }\n        }\n        const $copyButton = $(\"<button>\")\n            .attr({\n            \"type\": \"button\",\n            \"id\": options.name + \"-copy\",\n        })\n            .addClass(\"button btn-neutral border-highlight border-left\")\n            .html(`<i class=\"far fa-copy\"></i>`)\n            .appendTo($element);\n        if (options.title) {\n            $input.attr(\"title\", options.title);\n            $copyButton.attr(\"title\", options.title);\n        }\n        let copyTimer;\n        $($copyButton).on(\"click\", () => {\n            XM.Util.setClipboard($input.val());\n            window.clearTimeout(copyTimer);\n            $input.addClass(\"highlight\");\n            copyTimer = window.setTimeout(() => $input.removeClass(\"highlight\"), 250);\n        });\n        return new FormElement($element, $input, $label);\n    }\n    /**\n     * Creates a key input FormElement based on the provided parameters\n     * @param options Element configuration\n     */\n    static key(options, changed) {\n        if (!options.name)\n            options.name = Util.ID.make();\n        let $label;\n        if (options.label)\n            $label = FormUtils.makeLabel(options.name, options.label);\n        const $element = FormUtils\n            .makeInputWrapper(options.label, options.wrapper, options.width)\n            .addClass(\"keyinput\");\n        const $input = $(\"<input>\")\n            .attr({\n            \"type\": \"text\",\n            \"id\": options.name,\n            \"readonly\": \"\",\n        })\n            .addClass(\"bg-section color-text\")\n            .appendTo($element);\n        if (options.value !== undefined && options.value !== null) {\n            switch (typeof options.value) {\n                case \"function\": {\n                    options.value($input);\n                    break;\n                }\n                case \"object\": {\n                    $input.val(options.value.text());\n                    break;\n                }\n                case \"boolean\":\n                    options.value = options.value + \"\";\n                default: {\n                    $input\n                        .val(options.value)\n                        .attr(\"defval\", options.value);\n                }\n            }\n            $input.attr(\"key\", $input.val() + \"\");\n        }\n        const $warning = $(\"<span>\")\n            .addClass(\"keyinput-warning\")\n            .attr(\"title\", \"Duplicate Keybinding\")\n            .appendTo($element);\n        if (KeybindManager.count($input.val() + \"\") <= 1)\n            $warning.addClass(\"display-none\");\n        const $recordButton = $(\"<button>\")\n            .attr({\n            \"type\": \"button\",\n            \"id\": options.name + \"-key\",\n        })\n            .addClass(\"button btn-neutral border-highlight border-left\")\n            .html(`<i class=\"far fa-keyboard\"></i>`)\n            .appendTo($element);\n        if (options.title) {\n            $input.attr(\"title\", options.title);\n            $recordButton.attr(\"title\", options.title);\n        }\n        let occupied = false;\n        $($recordButton).on(\"click\", () => {\n            if (occupied)\n                return;\n            occupied = true;\n            const duplicates = $(`.keyinput input[key=\"${$input.val()}\"]`);\n            if (duplicates.length > 2) {\n                $warning.addClass(\"display-none\");\n            }\n            else {\n                duplicates\n                    .parent()\n                    .find(\"span.keyinput-warning\")\n                    .addClass(\"display-none\");\n            }\n            $input\n                .addClass(\"input-info\")\n                .val(\"Recording\");\n            KeybindManager.record((sequence) => {\n                if (sequence.includes(\"escape\")) {\n                    $input\n                        .removeClass(\"input-info\")\n                        .val(\"\")\n                        .attr(\"key\", \"\");\n                    if (changed !== undefined)\n                        changed(\"\", $input);\n                    occupied = false;\n                }\n                else {\n                    const newVal = flattenSequence(sequence);\n                    $input\n                        .removeClass(\"input-info\")\n                        .val(newVal)\n                        .attr(\"key\", newVal);\n                    const duplicates = $(`.keyinput input[key=\"${newVal}\"]`);\n                    if (duplicates.length > 1) {\n                        duplicates\n                            .parent()\n                            .find(\"span.keyinput-warning\")\n                            .removeClass(\"display-none\");\n                    }\n                    if (changed !== undefined)\n                        changed(newVal, $input);\n                    occupied = false;\n                }\n            });\n        });\n        return new FormElement($element, $input, $label);\n        // If a modifier key is pressed, the hotkey library will\n        // add it to every element of the sequence. Since we are\n        // flattening the sequence anyways, it should be safe to\n        // get rid of them altogether.\n        function flattenSequence(input) {\n            input = input.join(\"+\").split(\"+\");\n            input = [...new Set(input)];\n            return input.join(\"+\");\n        }\n    }\n    /**\n     * Creates a file input FormElement based on the provided parameters\n     * @param options Element configuration\n     */\n    static file(options, changed) {\n        if (!options.name)\n            options.name = Util.ID.make();\n        let $label;\n        if (options.label)\n            $label = FormUtils.makeLabel(options.name, options.label);\n        const $element = FormUtils\n            .makeInputWrapper(options.label, options.wrapper, options.width)\n            .addClass(\"fileinput\");\n        const $input = $(\"<input>\")\n            .attr({\n            \"type\": \"file\",\n            \"accept\": options.accept,\n            \"id\": options.name,\n        })\n            .addClass(\"bg-section color-text\")\n            .prop(\"disabled\", options.disabled == true)\n            .appendTo($element);\n        if (options.title)\n            $input.attr(\"title\", options.title);\n        if (changed !== undefined) {\n            $input.on(\"change\", () => {\n                changed($input.prop(\"files\"), $input);\n            });\n        }\n        return new FormElement($element, $input, $label);\n    }\n    static icon(options, content, changed) {\n        if (!options.name)\n            options.name = Util.ID.make();\n        let $label;\n        if (options.label)\n            $label = FormUtils.makeLabel(options.name, options.label);\n        const $element = FormUtils.makeInputWrapper(options.label, options.wrapper, options.width);\n        const $input = $(\"<input>\")\n            .attr({\n            \"type\": \"text\",\n            \"id\": options.name,\n            \"name\": options.name,\n        })\n            .css(\"display\", \"none\")\n            .appendTo($element);\n        if (options.value !== undefined && options.value !== null) {\n            switch (typeof options.value) {\n                case \"function\": {\n                    options.value($input);\n                    break;\n                }\n                case \"object\": {\n                    $input.val(options.value.text());\n                    break;\n                }\n                case \"boolean\":\n                    options.value = options.value + \"\";\n                default: {\n                    $input\n                        .val(options.value)\n                        .attr(\"defval\", options.value);\n                }\n            }\n        }\n        const $selectContainer = $(\"<div>\")\n            .addClass(\"icon-picker\")\n            .appendTo($element);\n        for (const key in content) {\n            $(\"<a>\")\n                .attr(\"href\", \"#\")\n                .attr(\"data-value\", key)\n                .html(content[key] ? (\"&#x\" + content[key]) : \"&nbsp;\")\n                .appendTo($selectContainer);\n        }\n        $selectContainer.find(\"a\").on(\"click\", (event) => {\n            event.preventDefault();\n            $selectContainer.find(\"a\").removeClass(\"active\");\n            const $target = $(event.target);\n            $input.val($target.attr(\"data-value\"));\n            $target.addClass(\"active\");\n            if (changed)\n                changed($input.val().toString(), $input);\n        });\n        if (options.value) {\n            $selectContainer.find(\"a[data-value='\" + options.value + \"']\").first().trigger(\"click\");\n        }\n        else {\n            $selectContainer.find(\"a\").first().trigger(\"click\");\n        }\n        // When the field value is set externally, this event needs to be triggered on the text input field.\n        // There is probably a better way to do this, but this should work for now.\n        $input.on(\"re621:form:update\", () => {\n            console.log(\"updating\", $input.val());\n            if ($input.val() == \"\") {\n                $selectContainer.find(\"a\").first().trigger(\"click\");\n            }\n            else {\n                $selectContainer.find(\"a[data-value='\" + $input.val() + \"']\").first().trigger(\"click\");\n            }\n        });\n        return new FormElement($element, $input, $label);\n    }\n    /**\n     * Creates a button FormElement based on the provided parameters\n     * @param options Element configuration\n     * @param changed Input change callback\n     */\n    static button(options, changed) {\n        if (!options.name)\n            options.name = Util.ID.make();\n        let $label;\n        if (options.label)\n            $label = FormUtils.makeLabel(options.name, options.label);\n        const $element = FormUtils\n            .makeInputWrapper(options.label, options.wrapper, options.width);\n        const $input = $(\"<button>\")\n            .attr({\n            \"id\": options.name,\n            \"type\": options.type ? options.type : \"button\",\n        })\n            .addClass(\"button btn-neutral\")\n            .prop(\"disabled\", options.disabled == true)\n            .appendTo($element);\n        if (options.value !== undefined && options.value !== null) {\n            switch (typeof options.value) {\n                case \"function\": {\n                    options.value($input);\n                    break;\n                }\n                case \"object\": {\n                    $input.append(options.value);\n                    break;\n                }\n                case \"number\":\n                case \"boolean\":\n                    options.value = options.value + \"\";\n                default: {\n                    $input\n                        .html(options.value)\n                        .attr(\"defval\", options.value);\n                }\n            }\n        }\n        if (options.title)\n            $input.attr(\"title\", options.title);\n        if (changed !== undefined)\n            $input.on(\"click\", (event) => {\n                event.preventDefault();\n                changed(true, $input);\n            });\n        return new FormElement($element, $input, $label);\n    }\n    /**\n     * Creates a checkbox FormElement based on the provided parameters\n     * @param options Element configuration\n     * @param changed Input change callback\n     */\n    static checkbox(options, changed) {\n        if (!options.name)\n            options.name = Util.ID.make();\n        const $element = FormUtils\n            .makeInputWrapper(undefined, options.wrapper, options.width)\n            .addClass(\"checkbox-switch\")\n            .toggleClass(\"input-disabled\", options.disabled == true);\n        const $input = $(\"<input>\")\n            .attr({\n            \"id\": options.name,\n            \"name\": options.name,\n            \"type\": \"checkbox\",\n        })\n            .addClass(\"switch\")\n            .prop(\"disabled\", options.disabled == true)\n            .appendTo($element);\n        if (options.value !== undefined && options.value !== null) {\n            switch (typeof options.value) {\n                case \"function\": {\n                    options.value($input);\n                    break;\n                }\n                case \"object\": {\n                    break;\n                }\n                default: {\n                    $input\n                        .prop(\"checked\", options.value)\n                        .attr(\"defval\", options.value + \"\");\n                }\n            }\n        }\n        $(\"<label>\")\n            .attr(\"for\", options.name)\n            .addClass(\"switch\")\n            .appendTo($element);\n        if (options.label) {\n            $(\"<label>\")\n                .attr(\"for\", options.name)\n                .html(options.label)\n                .appendTo($element);\n        }\n        if (changed !== undefined)\n            $input.on(\"change\", () => { changed($input.is(\":checked\"), $input); });\n        return new FormElement($element, $input);\n    }\n    /**\n     * Creates a select FormElement based on the provided parameters\n     * @param options Element configuration\n     * @param content Select options data\n     * @param changed Input change callback\n     */\n    static select(options, content, changed) {\n        if (!options.name)\n            options.name = Util.ID.make();\n        let $label;\n        if (options.label)\n            $label = FormUtils.makeLabel(options.name, options.label);\n        const $element = FormUtils\n            .makeInputWrapper(options.label, options.wrapper, options.width);\n        const $input = $(\"<select>\")\n            .attr({\n            \"id\": options.name,\n            \"name\": options.name,\n        })\n            .addClass(\"button btn-neutral\")\n            .prop(\"disabled\", options.disabled == true)\n            .appendTo($element);\n        if (content !== undefined) {\n            if (typeof content === \"function\")\n                content = content();\n            for (const key in content)\n                $(\"<option>\").val(key).text(content[key]).appendTo($input);\n        }\n        if (options.value !== undefined && options.value !== null) {\n            switch (typeof options.value) {\n                case \"function\": {\n                    options.value($input);\n                    break;\n                }\n                case \"object\": {\n                    $input.val(options.value.text());\n                    break;\n                }\n                case \"boolean\":\n                    options.value = options.value + \"\";\n                default: {\n                    $input\n                        .val(options.value)\n                        .attr(\"defval\", options.value);\n                }\n            }\n        }\n        if (options.title)\n            $input.attr(\"title\", options.title);\n        if (changed !== undefined)\n            $input.on(\"change\", () => { changed($input.val().toString(), $input); });\n        return new FormElement($element, $input, $label);\n    }\n    /**\n     * Creates a header FormElement based on the provided parameters\n     * @param text Header text\n     * @param width Element span\n     */\n    static header(text, width) {\n        const $element = FormUtils.makeInputWrapper(undefined, undefined, width);\n        $(\"<h3>\")\n            .attr(\"id\", Util.ID.make())\n            .addClass(\"color-text\")\n            .html(text)\n            .appendTo($element);\n        return new FormElement($element);\n    }\n    /**\n     * Creates a div FormElement based on the provided parameters\n     * @param options Element configuration\n     */\n    static div(options) {\n        if (!options.name)\n            options.name = Util.ID.make();\n        let $label;\n        if (options.label)\n            $label = FormUtils.makeLabel(options.name, options.label);\n        const $element = FormUtils\n            .makeInputWrapper(options.label, options.wrapper, options.width)\n            .addClass(\"text-div\")\n            .attr(\"id\", options.name);\n        if (options.value !== undefined && options.value !== null) {\n            switch (typeof options.value) {\n                case \"function\": {\n                    options.value($element);\n                    break;\n                }\n                case \"object\": {\n                    $element.append(options.value);\n                    break;\n                }\n                case \"number\":\n                case \"boolean\":\n                    options.value = options.value + \"\";\n                default: {\n                    $element.html(options.value);\n                }\n            }\n        }\n        return new FormElement($element, undefined, $label);\n    }\n    /**\n     * Alias for `Form.div` with streamlined options\n     * @param text Div contents\n     * @param width Wrapper width\n     */\n    static text(text, width = 1, wrapper) {\n        return Form.div({ value: text, width: width, wrapper: wrapper });\n    }\n    static requiresReload() {\n        return Form.text(`<div class=\"text-center text-bold\">Requires a page reload</div>`, 1, \"align-middle\");\n    }\n    /**\n     * Alias for `Form.div` with some pre-built markup\n     * @param header First line of the header\n     * @param subheader Second line of the header\n     * @param width Wrapper width\n     */\n    static subheader(header, subheader, width = 1, name, wrapper) {\n        return Form.div({ value: `<b>${header}</b><br />${subheader}`, width: width, wrapper: \"subheader\" + (wrapper ? \" \" + wrapper : \"\"), name: name });\n    }\n    /**\n     * Creates an hr FormElement based on the provided parameters\n     * @param width Element width\n     */\n    static hr(width) {\n        const $element = FormUtils.makeInputWrapper(undefined, undefined, width);\n        $(\"<hr>\")\n            .attr(\"id\", Util.ID.make())\n            .addClass(\"color-text-muted\")\n            .appendTo($element);\n        return new FormElement($element);\n    }\n    /**\n     * Creates an empty spacer element\n     * @param width Element width\n     */\n    static spacer(width, unmargin = false) {\n        const $element = FormUtils.makeInputWrapper(undefined, undefined, width);\n        $(\"<spacer>\")\n            .attr(\"id\", Util.ID.make())\n            .toggleClass(\"unmargin\", unmargin)\n            .appendTo($element);\n        return new FormElement($element);\n    }\n}\nForm.inputTimeout = 500; // Typing timeout on text input fields\nclass FormUtils {\n    static makeLabel(name, text) {\n        return $(\"<label>\")\n            .attr(\"for\", name)\n            .html(text);\n    }\n    static makeInputWrapper(label, wrapper, width = 1) {\n        return $(\"<form-input>\")\n            .addClass(wrapper ? \" \" + wrapper : \"\")\n            .attr({\n            \"labeled\": label !== undefined ? \"\" : null,\n            \"colspan\": width !== 1 ? width : null,\n        });\n    }\n}\nexport class FormElement {\n    /**\n     * Constructs a form element based on provided data.\n     * Only the `wrapper` parameter is required, everything else is optional.\n     * @param wrapper Element that wraps the rest of the inputs\n     * @param input Input element, if there is one\n     * @param label Input label, if there is one\n     * @param content Contains other FormElements that need to be built and appended to this element\n     * @param container Container object for content. If omitted, defaults to wrapper\n     * @param postProcessing Function to run after the object has been built. Takes the wrapper as a parameter.\n     */\n    constructor(wrapper, input, label, content, container, postProcessing) {\n        this.wrapper = wrapper;\n        this.input = input;\n        this.label = label;\n        this.content = content ? content : [];\n        this.container = container ? container : wrapper;\n        this.postProcessing = postProcessing ? postProcessing : () => { return; };\n    }\n    getInput() {\n        return this.input;\n    }\n    getInputs() {\n        const result = [];\n        if (this.input)\n            result.push(this.input);\n        for (const entry of this.content)\n            result.push(...entry.getInputs());\n        return result;\n    }\n    build(parentID, force = false) {\n        if (force || !this.created) {\n            for (const entry of this.content) {\n                for (const childElem of entry.build(parentID + \"-\" + this.wrapper.attr(\"id\"), force))\n                    childElem.appendTo(this.container);\n            }\n            if (this.label !== undefined)\n                this.label.attr(\"for\", parentID + \"-\" + this.label.attr(\"for\"));\n            if (this.input !== undefined)\n                this.input.attr(\"id\", parentID + \"-\" + this.input.attr(\"id\"));\n            switch (this.wrapper.prop(\"tagName\")) {\n                case \"FORM-INPUT\": {\n                    if (this.wrapper.attr(\"id\"))\n                        this.wrapper.attr(\"id\", parentID + \"-\" + this.wrapper.attr(\"id\"));\n                    for (const label of this.wrapper.find(\"> label\")) {\n                        const $subLabel = $(label);\n                        $subLabel.attr(\"for\", parentID + \"-\" + $subLabel.attr(\"for\"));\n                    }\n                    break;\n                }\n                case \"FORM-SECTION\":\n                case \"FORM-ACCORDION\": {\n                    this.wrapper.attr(\"id\", parentID + \"-\" + this.wrapper.attr(\"id\"));\n                    break;\n                }\n            }\n            this.postProcessing(this.wrapper);\n            this.created = true;\n        }\n        if (this.label)\n            return [this.label, this.wrapper];\n        else\n            return [this.wrapper];\n    }\n}\nclass FormAccordionElement extends FormElement {\n}\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport XM from \"../components/api/XM\";\nimport Page from \"../components/data/Page\";\nimport PageObserver from \"../components/structure/PageObserver\";\nimport ErrorHandler from \"../components/utility/ErrorHandler\";\nexport default class Component {\n    constructor(options = {}) {\n        this.initialized = false; // Whether or not the component is currently running\n        this.eventIndex = 0; // Used to provide IDs to the component event listeners\n        // Component settings\n        // The Settings object defines default values and is used to access them via dynamic setters and getters\n        // The SettingsCache object stores the current values of the settings\n        this.Settings = {\n            enabled: true,\n        };\n        // Validate the options\n        if (options.name)\n            this.name = options.name;\n        else\n            this.name = this.constructor.name;\n        if (!options.constraint)\n            options.constraint = [];\n        else if (!Array.isArray(options.constraint))\n            options.constraint = [options.constraint];\n        this.constraintMatches = options.constraint.length == 0 || Page.matches(options.constraint);\n        if (!options.waitForDOM)\n            options.waitForDOM = false;\n        this.DOMLoadConditions = options.waitForDOM;\n        // TODO options.dependencies\n        // Initialize the settings cache\n        this.SettingsCache = {\n            enabled: true,\n        };\n        // Being component initialization\n        this.execPrepare()\n            .then(() => this.bootstrapSettings())\n            .then(() => {\n            // Check if page constraints match\n            if (!this.constraintMatches)\n                return;\n            // Determine when to create the DOM structure\n            if (typeof options.waitForDOM == \"string\") {\n                PageObserver.watch(options.waitForDOM).then((status) => {\n                    if (!status) {\n                        // TODO Page loaded, but the element was not found\n                        return;\n                    }\n                    this.execCreate();\n                });\n            }\n            else if (options.waitForDOM) {\n                $(() => this.execCreate());\n            }\n            else\n                this.execCreate();\n        });\n    }\n    /** Loads the settings from storage, and sets up listeners to sync them across tabs */\n    bootstrapSettings() {\n        return __awaiter(this, void 0, void 0, function* () {\n            // Load in the saved settings values\n            for (const [key, defaultValue] of Object.entries(this.Settings)) {\n                const savedValue = yield XM.Storage.getValue(this.name + \".\" + key, defaultValue);\n                this.SettingsCache[key] = savedValue;\n                // This is a hack, but I'm not sure how else I'm supposed\n                // to pass a reference to the parent object inside the\n                // dynamic getter / setter setup below.\n                // eslint-disable-next-line @typescript-eslint/no-this-alias\n                const passedThis = this;\n                // Define custom setters and getters\n                Object.defineProperty(this.Settings, key, {\n                    get() {\n                        return passedThis.SettingsCache[key];\n                    },\n                    set(newValue) {\n                        passedThis.SettingsCache[key] = newValue;\n                        console.log(JSON.stringify(newValue), JSON.stringify(defaultValue), JSON.stringify(newValue) == JSON.stringify(defaultValue));\n                        if (JSON.stringify(newValue) == JSON.stringify(defaultValue))\n                            XM.Storage.deleteValue(passedThis.name + \".\" + key);\n                        else\n                            XM.Storage.setValue(passedThis.name + \".\" + key, newValue);\n                    }\n                });\n                // Sync settings between tabs\n                XM.Storage.addListener(this.name + \".\" + key, (settingsTag, oldValue, newValue, remote) => {\n                    if (remote)\n                        this.SettingsCache[key] = newValue;\n                    this.trigger(\"settings.\" + key + (remote ? \".remote\" : \".local\"), newValue);\n                });\n            }\n            // Example of a settings listener.\n            // Loads the component if it's enabled, unloads it if it's disabled.\n            this.on(\"settings.enabled\", (value) => {\n                if (value)\n                    this.load();\n                else\n                    this.unload();\n            });\n        });\n    }\n    /**\n     * Loads the component's functionality.\n     * Aborted if some of the load conditions do not match.\n     */\n    load() {\n        return __awaiter(this, void 0, void 0, function* () {\n            // Check if page constraints match\n            if (!this.constraintMatches)\n                return;\n            // Determine when to create the DOM structure\n            if (typeof this.DOMLoadConditions == \"string\") {\n                PageObserver.watch(this.DOMLoadConditions).then((status) => {\n                    if (!status) {\n                        // TODO Page loaded, but the element was not found\n                        return;\n                    }\n                    this.execCreate();\n                });\n            }\n            else if (this.DOMLoadConditions) {\n                $(() => this.execCreate());\n            }\n            else\n                this.execCreate();\n            this.trigger(\"load\");\n        });\n    }\n    /** Unloads the component's functionality and returns the DOM to its original state */\n    unload() {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this.execDestroy();\n            this.trigger(\"unload\");\n        });\n    }\n    /** Restarts the component. Shorthand for running `unload()` and `load()`. */\n    reload() {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this.unload();\n            yield this.load();\n        });\n    }\n    /**\n     * Loads necessary component data.\n     * Executed before any initialization occurs, and runs even if the load conditions do not match\n     */\n    prepare() {\n        return __awaiter(this, void 0, void 0, function* () { });\n    }\n    /** Runs the component's `prepare()` function and loads settings */\n    execPrepare() {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                yield this.prepare();\n            }\n            catch (error) {\n                // TODO Error handling\n            }\n            this.trigger(\"prepare\");\n        });\n    }\n    /**\n     * Creates the component's DOM structure.\n     * Executed as soon as the load conditions match.\n     */\n    create() {\n        return __awaiter(this, void 0, void 0, function* () { });\n    }\n    /** Runs the component's `create()` function, sets corresponding variables and triggers events. */\n    execCreate() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this.initialized) {\n                // TODO Throw an error?\n                return;\n            }\n            try {\n                yield this.create();\n            }\n            catch (error) {\n                ErrorHandler.log(`[${this.name}] fatal crash during initialization`, error);\n                return;\n            }\n            this.initialized = true;\n            this.trigger(\"create\");\n        });\n    }\n    /**\n     * Completely removes the component's DOM structure and restores the original state.\n     * Typically executed when a component is disabled.\n     */\n    destroy() {\n        return __awaiter(this, void 0, void 0, function* () { });\n    }\n    execDestroy() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.initialized) {\n                // TODO Throw an error?\n                return;\n            }\n            try {\n                yield this.destroy();\n            }\n            catch (error) {\n                // TODO Error handling\n            }\n            this.initialized = false;\n            this.trigger(\"destroy\");\n        });\n    }\n    /** Execute all handlers for the specified component event */\n    trigger(event, data) {\n        $(document).trigger(`re621.${this.name}.${event}`, data);\n    }\n    /**\n     * Attach a handler function for the specified event to the component\n     * @returns Event ID, unique to this component, that can be used to unbind this handler\n     */\n    on(event, handler) {\n        $(document).on(`re621.${this.name}.${event}.${this.eventIndex}`, handler);\n        return this.eventIndex++;\n    }\n    /** Executes a handler function exactly once whe encountering a specified event */\n    one(event, handler) {\n        $(document).one(`re621.${this.name}.${event}`, handler);\n    }\n    /** Detaches handlers from the specified component event */\n    off(event, eventID) {\n        $(document).off(`re621.${this.name}.${event}` + (eventID ? `.${eventID}` : \"\"));\n    }\n}\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport Page from \"../../components/data/Page\";\nimport User from \"../../components/data/User\";\nimport { Form } from \"../../components/structure/Form\";\nimport Modal from \"../../components/structure/Modal\";\nimport Util from \"../../components/utility/Util\";\nimport Component from \"../Component\";\n/**\n * HeaderCustomizer\n * Add, remove, and re-arrange the tabs in the customizable navbar\n */\nexport default class HeaderCustomizer extends Component {\n    constructor() {\n        super({ waitForDOM: \"menu.extra\" });\n        this.editingMode = false;\n        this.Settings = {\n            enabled: true,\n            hotkeyTab1: \"1\",\n            hotkeyTab2: \"2\",\n            hotkeyTab3: \"3\",\n            hotkeyTab4: \"4\",\n            hotkeyTab5: \"5\",\n            hotkeyTab6: \"6\",\n            hotkeyTab7: \"7\",\n            hotkeyTab8: \"8\",\n            hotkeyTab9: \"9\",\n            tabs: [\n                { name: \"Profile\", href: \"/users/%userID%\" },\n                { name: \"Posts\", href: \"/posts\" },\n                { name: \"Comments\", href: \"/comments?group_by=post\" },\n                { name: \"Artists\", href: \"/artists\" },\n                { name: \"Tags\", href: \"/tags\" },\n                { name: \"Blips\", href: \"/blips\" },\n                { name: \"Pools\", href: \"/pools\" },\n                { name: \"Sets\", href: \"/post_sets\" },\n                { name: \"Wiki\", href: \"/wiki_pages?title=help:home\" },\n                { name: \"Forum\", href: \"/forum_topics\" },\n                { name: \"Discord\", href: \"/static/discord\" },\n                { name: \"Help\", href: \"/help\" },\n                { name: \"More \", href: \"/static/site_map\" },\n            ],\n            forumUpdateDot: true,\n        };\n        /*\n        this.registerHotkeys(\n            { keys: \"hotkeyTab1\", fnct: () => { HeaderCustomizer.openTabNum(0); } },\n            { keys: \"hotkeyTab2\", fnct: () => { HeaderCustomizer.openTabNum(1); } },\n            { keys: \"hotkeyTab3\", fnct: () => { HeaderCustomizer.openTabNum(2); } },\n            { keys: \"hotkeyTab4\", fnct: () => { HeaderCustomizer.openTabNum(3); } },\n            { keys: \"hotkeyTab5\", fnct: () => { HeaderCustomizer.openTabNum(4); } },\n            { keys: \"hotkeyTab6\", fnct: () => { HeaderCustomizer.openTabNum(5); } },\n            { keys: \"hotkeyTab7\", fnct: () => { HeaderCustomizer.openTabNum(6); } },\n            { keys: \"hotkeyTab8\", fnct: () => { HeaderCustomizer.openTabNum(7); } },\n            { keys: \"hotkeyTab9\", fnct: () => { HeaderCustomizer.openTabNum(8); } },\n        );\n        */\n    }\n    get isEditing() { return this.editingMode; }\n    set isEditing(value) {\n        this.editingMode = value;\n        if (value) {\n            this.$menu.attr(\"data-editing\", \"true\");\n            this.$menu.sortable(\"enable\");\n            this.addTabModal.open();\n            this.updateTabModal.enable();\n        }\n        else {\n            this.$menu.attr(\"data-editing\", \"false\");\n            this.$menu.sortable(\"disable\");\n            this.addTabModal.close();\n            this.updateTabModal.close();\n            this.updateTabModal.disable();\n        }\n    }\n    /**\n     * Creates the module's structure.\n     * Should be run immediately after the constructor finishes.\n     */\n    create() {\n        return __awaiter(this, void 0, void 0, function* () {\n            // Check for forum updates before the structure changes\n            this.hasForumUpdates = $(\"li#nav-forum\").hasClass(\"forum-updated\");\n            // Create the structure and store the old navbar for later\n            this.$menu = $(\"menu.main\");\n            this.$oldMenu = $(\"<div>\").css(\"display\", \"none\").appendTo(\"body\");\n            this.$menu.children().appendTo(this.$oldMenu);\n            this.$menu.addClass(\"custom\");\n            // Load stored data\n            this.rebuildTabs();\n            this.toggleForumDot(this.Settings.forumUpdateDot);\n            this.createConfigInterface();\n            this.$menu.sortable({\n                axis: \"x\",\n                containment: \"parent\",\n                helper: \"clone\",\n                forceHelperSize: true,\n                opacity: 0.75,\n                cursor: \"grabbing\",\n                disabled: true,\n                update: () => {\n                    this.reloadTabMargins();\n                    this.saveNavbarSettings();\n                },\n            });\n            // Listen to settings events and update the structure\n            this.on(\"settings.tabs.remote\", () => {\n                this.isEditing = false;\n                this.rebuildTabs();\n                this.updateTabModal.clearTriggers();\n                this.updateTabModal.registerTrigger({ element: $(\"menu.main li a\") });\n            });\n            this.on(\"settings.forumUpdateDot.remote\", () => {\n                this.toggleForumDot(this.Settings.forumUpdateDot);\n            });\n        });\n    }\n    destroy() {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.$menu.removeClass(\"custom\").empty();\n            this.$menu.sortable(\"destroy\");\n            this.addTabButton.remove();\n            this.addTabModal.destroy();\n            this.updateTabModal.destroy();\n            this.$oldMenu.children().appendTo(this.$menu);\n            this.$oldMenu.remove();\n        });\n    }\n    /** Creates the configuration forms and modals */\n    createConfigInterface() {\n        // === Tab Configuration Interface\n        this.addTabButton = Util.DOM.addSettingsButton({\n            id: \"header-button-customizer\",\n            name: `<i class=\"fas fa-tasks\"></i>`,\n            title: \"Edit Header Tabs\",\n            tabClass: \"float-left\",\n            onClick: () => { this.isEditing = !this.isEditing; }\n        });\n        const newTabForm = new Form({ name: \"header-customizer-new\" }, [\n            Form.input({ label: \"Name\", name: \"name\", value: \"\", required: true, pattern: \"[\\\\S ]+\" }),\n            Form.input({ label: \"Hover\", value: \"\", name: \"title\" }),\n            Form.input({ label: \"Link\", value: \"\", name: \"href\" }),\n            Form.checkbox({ label: \"Attach to the right side\", value: false, name: \"right\" }),\n            Form.button({ value: \"Submit\", type: \"submit\" }),\n            Form.hr(),\n            Form.div({ value: \"Available variables:\" }),\n            Form.copy({ label: \"Unique ID\", value: \"%userID%\" }),\n            Form.copy({ label: \"Username\", value: \"%username%\" }),\n            Form.hr(),\n            Form.div({ value: \"Drag-and-drop tabs to re-arrange.<br />Click on a tab to edit it.\" }),\n        ], (values, form) => {\n            this.addTab({\n                name: values[\"name\"],\n                title: values[\"title\"],\n                href: values[\"href\"],\n                right: values[\"right\"],\n            });\n            form.reset();\n            this.reloadTabMargins();\n        });\n        this.addTabModal = new Modal({\n            title: \"Add Tab\",\n            content: Form.placeholder(),\n            structure: newTabForm,\n            position: { my: \"right top\", at: \"right top\" }\n        });\n        this.addTabModal.getElement().on(\"dialogclose\", () => { this.isEditing = false; });\n        // Tab Update Interface\n        this.updateTabForm = new Form({ name: \"header-customizer-update\" }, [\n            Form.input({ label: \"Name\", name: \"name\", value: \"\", required: true, pattern: \"[\\\\S ]+\" }),\n            Form.input({ label: \"Hover\", value: \"\", name: \"title\" }),\n            Form.input({ label: \"Link\", value: \"\", name: \"href\" }),\n            Form.checkbox({ label: \"Attach to the right side\", value: false, name: \"right\" }),\n            Form.button({ value: \"Delete\", type: \"button\" }, () => {\n                this.deleteTab(this.updateTabModal.getActiveTrigger().parent());\n                this.updateTabModal.close();\n            }),\n            Form.button({ value: \"Update\", type: \"submit\" }),\n        ], (values, form) => {\n            this.updateTab(this.updateTabModal.getActiveTrigger().parent(), {\n                name: values[\"name\"],\n                title: values[\"title\"],\n                href: values[\"href\"],\n                right: values[\"right\"],\n            });\n            this.updateTabModal.close();\n            form.reset();\n            this.reloadTabMargins();\n        });\n        this.updateTabModal = new Modal({\n            title: \"Update Tab\",\n            triggers: [{ element: $(\"menu.main li a\") }],\n            content: Form.placeholder(),\n            structure: this.updateTabForm,\n            position: { my: \"center top\", at: \"center top\" },\n            triggerMulti: true,\n            disabled: true,\n        });\n        // Fill in update tab data\n        this.updateTabModal.getElement().on(\"dialogopen\", () => {\n            const $tab = this.updateTabModal.getActiveTrigger().parent();\n            const $updateTabInputs = this.updateTabForm.getInputList();\n            $updateTabInputs.get(\"name\").val($tab.data(\"tab.name\"));\n            $updateTabInputs.get(\"title\").val($tab.data(\"tab.title\"));\n            $updateTabInputs.get(\"href\").val($tab.data(\"tab.href\"));\n            $updateTabInputs.get(\"right\").prop(\"checked\", $tab.data(\"tab.right\"));\n        });\n    }\n    rebuildTabs() {\n        this.$menu.html(\"\");\n        for (const value of this.Settings.tabs)\n            this.createTabElement(value);\n        this.reloadTabMargins();\n    }\n    /** Toggles the red dot next to the forum tab */\n    toggleForumDot(state) {\n        this.$menu.attr(\"data-forumdot\", \"\" + state);\n    }\n    /**\n     * Creates a new styled tab\n     * @param config Tab configuration\n     */\n    createTabElement(config, triggerUpdate = false) {\n        config = this.parseHeaderTabConfig(config);\n        const $tab = $(`<li>`)\n            .data({\n            \"tab.name\": config.name,\n            \"tab.title\": config.title,\n            \"tab.href\": config.href,\n            \"tab.right\": config.right,\n        })\n            .attr(\"align\", config.right ? \"true\" : undefined)\n            .appendTo(this.$menu);\n        const $link = $(\"<a>\")\n            .html(this.processTabVariables(config.name))\n            .appendTo($tab);\n        if (config.title !== \"\")\n            $link.attr(\"title\", this.processTabVariables(config.title));\n        if (config.href !== \"\")\n            $link.attr(\"href\", this.processTabVariables(config.href));\n        if (config.href === \"/forum_topics\" && this.hasForumUpdates)\n            $link.addClass(\"tab-has-updates\");\n        else if ((config.href == \"/users/%userID%\" || config.href == \"/users/home\") && !User.loggedIn) {\n            $link\n                .attr(\"href\", \"/session/new\")\n                .addClass(\"tab-login\")\n                .html(\"Sign In\");\n        }\n        if (triggerUpdate) {\n            this.saveNavbarSettings();\n        }\n        if (config.href.trim() !== \"\" && Page.getURL().pathname.includes(this.processTabVariables(config.href).split(\"?\")[0])) {\n            $tab.addClass(\"bg-foreground\");\n        }\n        return { tab: $tab, link: $link };\n    }\n    /**\n     * Parses the provided configuration file for missing values\n     * @param config Configuration to process\n     */\n    parseHeaderTabConfig(config) {\n        if (config.name === undefined)\n            config.name = \"New Tab\";\n        if (config.href === undefined)\n            config.href = \"\";\n        if (config.title === undefined)\n            config.title = \"\";\n        if (config.right === undefined)\n            config.right = false;\n        return config;\n    }\n    /**\n     * Creates a new tab based on specified configuration\n     * @param config Configuration\n     */\n    addTab(config) {\n        config = this.parseHeaderTabConfig(config);\n        const newTab = this.createTabElement(config, true);\n        this.updateTabModal.registerTrigger({ element: newTab.link });\n    }\n    /**\n     * Update the specified tab with the corresponding configuration\n     * @param $element Tab to update\n     * @param config New configuration\n     */\n    updateTab($element, config) {\n        config = this.parseHeaderTabConfig(config);\n        $element\n            .data({\n            \"tab.name\": config.name,\n            \"tab.title\": config.title,\n            \"tab.href\": config.href,\n            \"tab.right\": config.right,\n        })\n            .removeAttr(\"align\")\n            .attr(\"align\", config.right ? \"true\" : undefined);\n        $element.find(\"a\").first()\n            .html(this.processTabVariables(config.name))\n            .attr(\"title\", this.processTabVariables(config.title))\n            .attr(\"href\", this.processTabVariables(config.href));\n        this.saveNavbarSettings();\n    }\n    /**\n     * Remove the specified tab\n     * @param $element LI element of the tab\n     */\n    deleteTab($element) {\n        $element.remove();\n        this.saveNavbarSettings();\n    }\n    /**\n     * Replaces the variables in the text with corresponding values\n     * @param text Text to parse\n     */\n    processTabVariables(text) {\n        return text\n            .replace(/%userID%/gi, User.userID + \"\")\n            .replace(/%username%/gi, User.username);\n    }\n    /**\n     * Iterates over the header menu and saves the data to cookies\n     */\n    saveNavbarSettings() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const tabData = [];\n            this.$menu.find(\"li\").each(function (i, element) {\n                const $tab = $(element);\n                tabData.push({\n                    name: formatVal($tab.data(\"tab.name\")),\n                    title: formatVal($tab.data(\"tab.title\")),\n                    href: formatVal($tab.data(\"tab.href\")),\n                    right: $tab.data(\"tab.right\") ? true : undefined,\n                });\n            });\n            this.Settings.tabs = tabData;\n            function formatVal(value) {\n                if (value)\n                    return value;\n                return undefined;\n            }\n        });\n    }\n    /** Emulates a click on the header tab with the specified index */\n    /*\n    private static openTabNum(num: number): void {\n        const tabs = ModuleController.get(HeaderCustomizer).$menu.find<HTMLElement>(\"li > a\");\n        if (num > tabs.length) return;\n        tabs[num].click();\n    }\n    */\n    /** Refreshes the right-aligned tabs to have proper margins */\n    reloadTabMargins() {\n        this.$menu.children(\"li\").removeClass(\"margined\");\n        this.$menu.find(\"li[align=true]\")\n            .first()\n            .addClass(\"margined\");\n    }\n}\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { Form } from \"../../components/structure/Form\";\nimport Modal from \"../../components/structure/Modal\";\nimport Util from \"../../components/utility/Util\";\nimport Component from \"../Component\";\nexport default class ThemeCustomizer extends Component {\n    create() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const openCustomizerButton = Util.DOM.addSettingsButton({\n                id: \"header-button-theme\",\n                name: `<i class=\"fas fa-paint-brush\"></i>`,\n                title: \"Change Theme\",\n            });\n            // === Establish the settings window contents\n            const form = new Form({ name: \"theme-customizer\" }, [\n                Form.select({\n                    label: \"Theme\",\n                    name: \"th-main\",\n                    value: (element) => {\n                        this.$main = element;\n                        element.val(window.localStorage.getItem(\"theme\") || \"hexagon\");\n                    },\n                }, {\n                    \"hexagon\": \"Hexagon\",\n                    \"pony\": \"Pony\",\n                    \"bloodlust\": \"Bloodlust\",\n                    \"serpent\": \"Serpent\",\n                    \"hotdog\": \"Hotdog\",\n                }, (data) => {\n                    Util.LS.setItem(\"theme\", data);\n                    $(\"body\").attr(\"data-th-main\", data);\n                    this.trigger(\"switch.theme\", data);\n                }),\n                Form.select({\n                    label: \"Extras\",\n                    name: \"th-extra\",\n                    value: (element) => {\n                        this.$extra = element;\n                        element.val(window.localStorage.getItem(\"theme-extra\") || \"hexagons\");\n                    },\n                }, {\n                    \"none\": \"None\",\n                    \"aurora\": \"Aurora\",\n                    \"autumn\": \"Autumn\",\n                    \"hexagon\": \"Hexagon\",\n                    \"space\": \"Space\",\n                    \"spring\": \"Spring\",\n                    \"stars\": \"Stars\",\n                    \"winter\": \"Winter\",\n                }, (data) => {\n                    Util.LS.setItem(\"theme-extra\", data);\n                    $(\"body\").attr(\"data-th-extra\", data);\n                    this.trigger(\"switch.extras\", data);\n                }),\n                Form.select({\n                    label: \"Post Navbar\",\n                    name: \"th-nav\",\n                    value: (element) => {\n                        this.$nav = element;\n                        element.val(Util.LS.getItem(\"theme-nav\") || \"top\");\n                    },\n                }, {\n                    \"top\": \"Top\",\n                    \"bottom\": \"Bottom\",\n                    \"both\": \"Both\",\n                    \"left\": \"Sidebar\",\n                    \"none\": \"None\",\n                }, (data) => {\n                    Util.LS.setItem(\"theme-nav\", \"top\");\n                    $(\"body\").attr(\"data-th-nav\", data);\n                    this.trigger(\"switch.navbar\", data);\n                }),\n            ]);\n            // === Create the modal\n            new Modal({\n                title: \"Themes\",\n                triggers: [{ element: openCustomizerButton }],\n                content: Form.placeholder(),\n                structure: form,\n                position: { my: \"right top\", at: \"right top\" }\n            });\n            $(window).on(\"storage\", (event) => {\n                let data = event.originalEvent[\"newValue\"];\n                switch (event.originalEvent[\"key\"]) {\n                    case \"theme\": {\n                        data = data || \"hexagon\";\n                        $(\"body\").attr(\"data-th-main\", data);\n                        this.$main.val(data);\n                        break;\n                    }\n                    case \"theme-extra\": {\n                        data = data || \"hexagon\";\n                        $(\"body\").attr(\"data-th-extra\", data);\n                        this.$extra.val(data);\n                        break;\n                    }\n                    case \"theme-nav\": {\n                        data = data || \"top\";\n                        $(\"body\").attr(\"data-th-nav\", data);\n                        this.$nav.val(data);\n                        break;\n                    }\n                }\n            });\n        });\n    }\n}\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport Util from \"../../components/utility/Util\";\nimport Component from \"../Component\";\nexport default class DMailHeaderButton extends Component {\n    constructor() {\n        super({\n            waitForDOM: \"menu.extra\",\n        });\n    }\n    create() {\n        return __awaiter(this, void 0, void 0, function* () {\n            Util.DOM.addSettingsButton({\n                id: \"header-button-dmail\",\n                name: `<i class=\"fas fa-envelope\"></i>`,\n                href: \"/dmails\",\n                title: \"DMail\",\n            });\n        });\n    }\n}\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport css from \"./css/style.module.scss\";\nimport User from \"./js/components/data/User\";\nimport DOMTools from \"./js/components/structure/DOMTools\";\nimport PageObserver from \"./js/components/structure/PageObserver\";\nimport Debug from \"./js/components/utility/Debug\";\nimport ErrorHandler from \"./js/components/utility/ErrorHandler\";\nimport HeaderCustomizer from \"./js/modules/general/HeaderCustomizer\";\nimport ThemeCustomizer from \"./js/modules/general/ThemeCustomizer\";\nimport DMailHeaderButton from \"./js/modules/minor/DMailHeaderButton\";\nexport class RE621 {\n    constructor() {\n        this.loadOrder = [\n            // Header\n            ThemeCustomizer,\n            HeaderCustomizer,\n            DMailHeaderButton,\n        ];\n    }\n    run() {\n        return __awaiter(this, void 0, void 0, function* () {\n            console.log(\"[%cRE621 v.1.0.0%c]\", \"color: maroon\", \"color: black\");\n            // Initialize basic functionality\n            try {\n                console.log(\"+ Page Observer\");\n                PageObserver.init();\n                // Append the CSS to head, and make sure it overrides other styles\n                PageObserver.watch(\"head\").then(() => {\n                    Debug.log(\"+ HEAD is ready\");\n                    const styleElement = DOMTools.addStyle(css);\n                    $(() => { styleElement.appendTo(\"head\"); });\n                });\n                PageObserver.watch(\"body\").then(() => {\n                    Debug.log(\"+ BODY is ready\");\n                    // Dialog.init();\n                    DOMTools.setupDialogContainer(); // TODO Move to the dialog class\n                    User.init();\n                });\n                PageObserver.watch(\"menu.main\").then(() => {\n                    Debug.log(\"+ MENU is ready\");\n                    DOMTools.patchHeader();\n                });\n            }\n            catch (error) {\n                ErrorHandler.log(\"An error ocurred during script initialization\", error);\n                return;\n            }\n            // Start loading components\n            for (const module of this.loadOrder)\n                RE621.modules[module.constructor.name] = new module();\n        });\n    }\n}\n// Fill in type suggestions\nRE621.modules = {};\nnew RE621().run();\n"],"names":["XMConnect","static","details","Debug","connectLog","url","GM_xmlhttpRequest","validateXHRDetails","validDetails","Promise","resolve","reject","callbacks","onabort","onerror","onload","onloadstart","onprogress","onreadystatechange","ontimeout","event","xmlHttpRequest","undefined","headers","window","a","b","timer","name","method","responseType","clearTimeout","setTimeout","btn","$","attr","href","URL","createObjectURL","response","download","html","on","remove","click","c","getState","XM","Connect","saveAs","error","GM_download","Storage","XMStorage","value","GM_setValue","defaultValue","GM_getValue","GM_deleteValue","callback","GM_addValueChangeListener","id","GM_removeValueChangeListener","Util","XMUtil","path","active","GM_openInTab","data","info","GM_setClipboard","Window","unsafeWindow","Info","GM_info","__awaiter","thisArg","_arguments","P","generator","fulfilled","step","next","e","rejected","result","done","then","apply","this","enabled","getValue","connect","perform","vivaldi","type","setValue","deleteValue","console","log","obj","table","input","time","timeEnd","UtilID","length","unique","getRandomString","uniqueID","uniqueIDs","has","add","chars","charLength","i","charAt","Math","floor","random","delete","Time","now","slice","Set","UtilSize","UtilTime","format","bytes","decimals","parseInt","dm","parseFloat","pow","toFixed","unformat","isNumeric","toUpperCase","index","size","entries","test","RISSizeLimit","constructor","width","height","post","file","img","toString","Google","Megabyte","SauceNAO","Derpibooru","Kheina","Yandex","Date","getTime","ago","timeFormats","seconds","token","listChoice","abs","date","parts","year","getFullYear","month","getMonth","day","getDate","hours","getHours","minutes","getMinutes","getSeconds","formatPeriod","MINUTE","SECOND","HOUR","DAY","WEEK","MONTH","YEAR","getDatetimeShort","twoDigit","n","substring","formatPlaytime","remainder","ceil","tempLink","encodeURIComponent","JSON","stringify","appendTo","Array","isArray","from","push","splice","indexes","replace","removeSections","num","sign","d","gcd","u","v","val","trim","toLowerCase","element","getTags","getTagString","split","filter","el","object","key","Object","keys","RegExp","join","v1","v2","options","lexicographical","zeroExtend","NaN","v1parts","v2parts","isValidPart","x","every","map","Number","array","delimiter","DOM","UtilDOM","config","target","title","tabClass","linkClass","$tab","$link","onClick","addClass","css","ID","make","Events","UtilEvents","document","off","trigger","label","createEvent","initEvent","dispatchEvent","UtilMath","min","max","isNaN","decimal","Network","UtilNetwork","navigator","onLine","location","host","Size","LS","localStorage","SS","sessionStorage","ENDPOINT_DEFS","node","APIEndpoint","queue","endpoint","param","get","query","delay","createRequest","getParsedPath","formatParam","formatData","first","noEncode","put","patch","output","elem","cleanURIComponent","subKey","subValue","subElement","decodeURIComponent","E621","emitter","processing","requestIndex","endpoints","authToken","forEach","definition","instance","requestBody","requestRateLimit","requestInfo","credentials","mode","body","FormattedAPIQuery","entry","Request","origin","final","one","status","includes","request","newItem","item","shift","fetch","ok","responseText","text","parse","statusText","sleep","Posts","getEndpoint","Post","PostVotes","Tags","Tag","TagAliases","TagImplications","Notes","Favorites","Favorite","Pools","Pool","Sets","SetAddPost","SetRemovePost","Users","User","Blips","Wiki","Comments","Comment","ForumPosts","ForumPost","ForumTopics","ForumTopic","DTextPreview","IQDBQueries","ImageScalingMode","loggedIn","userIsAnonymous","username","userName","userID","userId","level","userLevel","levelString","userLevelString","isMember","userIsMemeber","isPrivileged","userIsPrivileged","isContributor","userIsContributor","isJanitor","userIsJanitor","isModerator","userIsModerator","isAdmin","userIsAdmin","isFormerStaff","userIsFormerStaff","isVoter","userIsVoter","isVerified","userIsVerified","isApprover","userIsApprover","isBlocked","userIsBlocked","isBanned","userIsBanned","canApprovePosts","userCanApprovePosts","canUploadFree","userCanUploadFree","postsPerPage","userPerPage","commentThreshold","blacklistedTags","blacklistUsers","enableJSNavigation","enableAutoComplete","styleUsernames","defaultImageSize","user","Sample","FitHeight","FitWidth","Original","Page","pathname","getInstance","constraint","searchParams","set","refreshCurrentUrl","searchPrefix","history","replaceState","hash","hostname","regex","PageDefinition","matches","search","upload","forum","forumPost","pool","popular","favorites","wiki","wikiNA","artist","comments","settings","changes","tickets","profile","iqdb","deleted_posts","blips","help","postConfirmDelete","DOMTools","$menuContainer","$menuMain","find","last","getSiteName","prependTo","insertAfter","PageObserver","observer","targets","Map","MutationObserver","selector","querySelector","observe","childList","subtree","disconnect","pageLoaded","values","hasFocus","visibilityState","Script","version","script","handler","scriptHandler","website","repo","issues","thread","latest","Modal","triggers","isDisabled","validateConfig","triggersMulti","triggerMulti","disabled","$modal","append","content","dialog","autoOpen","resizable","minWidth","minHeight","position","my","at","of","within","classes","closest","draggable","structure","render","registerTrigger","enable","disable","isOpen","open","close","toggle","addContent","$content","setContent","activeTrigger","preventDefault","$target","currentTarget","is","clearTriggers","getElement","destroy","getActiveTrigger","isReady","ErrorHandler","module","message","notice","textarea","userAgent","stack","watch","validKeys","replacedKeys","replacedRegExp","getKeyRegex","KeybindManager","blocked","keybind","register","refreshListener","executors","bindMeta","executor","listening","matched","indexOf","sequence","listeners","keydown","listenerExecutor","keyObj","holdable","fnct","$element","cooldown","Form","onSubmit","columns","wrapper","inputList","force","created","innerHTML","formID","childElem","build","getInputs","reset","defval","prop","getInputList","names","results","spacer","$label","FormUtils","makeLabel","toggleClass","FormElement","postElement","accordion","animate","collapsible","header","subheader","badge","onActivate","container","collapsed","beforeActivate","changed","makeInputWrapper","$input","pattern","required","inputTimeout","$copyButton","copyTimer","setClipboard","removeClass","$warning","count","$recordButton","occupied","duplicates","parent","record","newVal","accept","$selectContainer","div","unmargin","postProcessing","getInput","parentID","$subLabel","Component","initialized","eventIndex","Settings","constraintMatches","waitForDOM","DOMLoadConditions","SettingsCache","execPrepare","bootstrapSettings","execCreate","savedValue","passedThis","defineProperty","newValue","addListener","settingsTag","oldValue","remote","load","unload","execDestroy","reload","prepare","create","eventID","HeaderCustomizer","super","editingMode","hotkeyTab1","hotkeyTab2","hotkeyTab3","hotkeyTab4","hotkeyTab5","hotkeyTab6","hotkeyTab7","hotkeyTab8","hotkeyTab9","tabs","forumUpdateDot","isEditing","$menu","sortable","addTabModal","updateTabModal","hasForumUpdates","hasClass","$oldMenu","children","rebuildTabs","toggleForumDot","createConfigInterface","axis","containment","helper","forceHelperSize","opacity","cursor","update","reloadTabMargins","saveNavbarSettings","empty","addTabButton","addSettingsButton","newTabForm","checkbox","button","hr","copy","form","addTab","right","placeholder","updateTabForm","deleteTab","updateTab","$updateTabInputs","createTabElement","state","triggerUpdate","parseHeaderTabConfig","processTabVariables","getURL","tab","link","newTab","removeAttr","tabData","formatVal","each","ThemeCustomizer","openCustomizerButton","select","$main","getItem","setItem","$extra","$nav","originalEvent","DMailHeaderButton","RE621","loadOrder","run","init","styleElement","addStyle","setupDialogContainer","patchHeader","modules"],"sourceRoot":""}